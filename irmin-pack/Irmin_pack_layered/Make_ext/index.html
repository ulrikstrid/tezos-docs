<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make_ext (irmin-pack.Irmin_pack_layered.Make_ext)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">irmin-pack</a> &#x00BB; <a href="../index.html">Irmin_pack_layered</a> &#x00BB; Make_ext</nav><header class="odoc-preamble"><h1>Module <code><span>Irmin_pack_layered.Make_ext</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter" id="argument-1-Config" class="anchored"><a href="#argument-1-Config" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Config/index.html">Config</a></span><span> : <a href="../../Irmin_pack/Config/module-type-S/index.html">Irmin_pack.Config.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-2-Metadata" class="anchored"><a href="#argument-2-Metadata" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-Metadata/index.html">Metadata</a></span><span> : <a href="../../../irmin/Irmin/Metadata/module-type-S/index.html">Irmin.Metadata.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-3-Contents" class="anchored"><a href="#argument-3-Contents" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-3-Contents/index.html">Contents</a></span><span> : <a href="../../../irmin/Irmin/Contents/module-type-S/index.html">Irmin.Contents.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-4-Path" class="anchored"><a href="#argument-4-Path" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-4-Path/index.html">Path</a></span><span> : <a href="../../../irmin/Irmin/Path/module-type-S/index.html">Irmin.Path.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-5-Branch" class="anchored"><a href="#argument-5-Branch" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-5-Branch/index.html">Branch</a></span><span> : <a href="../../../irmin/Irmin/Branch/module-type-S/index.html">Irmin.Branch.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-6-Hash" class="anchored"><a href="#argument-6-Hash" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-6-Hash/index.html">Hash</a></span><span> : <a href="../../../irmin/Irmin/Hash/module-type-S/index.html">Irmin.Hash.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-7-N" class="anchored"><a href="#argument-7-N" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-7-N/index.html">N</a></span><span> : <a href="../../../irmin/Irmin/Private/Node/module-type-S/index.html">Irmin.Private.Node.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Private/Node/module-type-S/index.html#type-metadata">metadata</a> = <a href="argument-2-Metadata/index.html#type-t">Metadata.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Private/Node/module-type-S/index.html#type-hash">hash</a> = <a href="argument-6-Hash/index.html#type-t">Hash.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Private/Node/module-type-S/index.html#type-step">step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-8-CT" class="anchored"><a href="#argument-8-CT" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-8-CT/index.html">CT</a></span><span> : <a href="../../../irmin/Irmin/Private/Commit/module-type-S/index.html">Irmin.Private.Commit.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Private/Commit/module-type-S/index.html#type-hash">hash</a> = <a href="argument-6-Hash/index.html#type-t">Hash.t</a></span></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-include"><div class="spec include"><div class="doc"><div class="odoc-include"><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span><span class="keyword">include</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html">Irmin_layers.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-key">key</a> = <a href="argument-4-Path/index.html#type-t">Path.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-contents">contents</a> = <a href="argument-3-Contents/index.html#type-t">Contents.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-branch">branch</a> = <a href="argument-5-Branch/index.html#type-t">Branch.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-hash">hash</a> = <a href="argument-6-Hash/index.html#type-t">Hash.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span>
<a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-step">step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/index.html#type-metadata">metadata</a> = <a href="argument-2-Metadata/index.html#type-t">Metadata.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin-layers/Irmin_layers/module-type-S/Key/index.html#type-step">Key.step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span></span></code></span></summary><div class="odoc-include"><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span><span class="keyword">include</span> <a href="../../../irmin/Irmin/module-type-S/index.html">Irmin.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/index.html#type-key">key</a> = <a href="argument-4-Path/index.html#type-t">Path.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/index.html#type-contents">contents</a> = <a href="argument-3-Contents/index.html#type-t">Contents.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/index.html#type-branch">branch</a> = <a href="argument-5-Branch/index.html#type-t">Branch.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/index.html#type-hash">hash</a> = <a href="argument-6-Hash/index.html#type-t">Hash.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span>
<a href="../../../irmin/Irmin/module-type-S/index.html#type-step">step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/index.html#type-metadata">metadata</a> = <a href="argument-2-Metadata/index.html#type-t">Metadata.t</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/module-type-S/Key/index.html#type-step">Key.step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span></span></code></span></summary><div class="odoc-include"><div class="spec include"><div class="doc"><h2 id="irmin-stores"><a href="#irmin-stores" class="anchor"></a>Irmin stores</h2><p>Irmin stores are tree-like read-write stores with extended capabilities. They allow an application (or a collection of applications) to work with multiple local states, which can be forked and merged programmatically, without having to rely on a global state. In a way very similar to version control systems, Irmin local states are called <i>branches</i>.</p><p>There are two kinds of store in Irmin: the ones based on <span class="xref-unresolved">persistent</span> named branches and the ones based <span class="xref-unresolved">temporary</span> detached heads. These exist relative to a local, larger (and shared) store, and have some (shared) contents. This is exactly the same as usual version control systems, that the informed user can see as an implicit purely functional data-structure.</p><div class="odoc-spec"><div class="spec type" id="type-repo" class="anchored"><a href="#type-repo" class="anchor"></a><code><span><span class="keyword">type</span> repo</span></code></div><div class="spec-doc"><p>The type for Irmin repositories.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type for Irmin stores.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-step" class="anchored"><a href="#type-step" class="anchor"></a><code><span><span class="keyword">type</span> step</span><span> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span></code></div><div class="spec-doc"><p>The type for <a href="#type-key"><code>key</code></a> steps.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-key" class="anchored"><a href="#type-key" class="anchor"></a><code><span><span class="keyword">type</span> key</span><span> = <a href="argument-4-Path/index.html#type-t">Path.t</a></span></code></div><div class="spec-doc"><p>The type for store keys. A key is a sequence of <a href="#type-step"><code>step</code></a>s.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-metadata" class="anchored"><a href="#type-metadata" class="anchor"></a><code><span><span class="keyword">type</span> metadata</span><span> = <a href="argument-2-Metadata/index.html#type-t">Metadata.t</a></span></code></div><div class="spec-doc"><p>The type for store metadata.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-contents" class="anchored"><a href="#type-contents" class="anchor"></a><code><span><span class="keyword">type</span> contents</span><span> = <a href="argument-3-Contents/index.html#type-t">Contents.t</a></span></code></div><div class="spec-doc"><p>The type for store contents.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-node" class="anchored"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> node</span></code></div><div class="spec-doc"><p>The type for store nodes.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-tree" class="anchored"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span></code></div><div class="spec-doc"><p>The type for store trees.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-hash" class="anchored"><a href="#type-hash" class="anchor"></a><code><span><span class="keyword">type</span> hash</span><span> = <a href="argument-6-Hash/index.html#type-t">Hash.t</a></span></code></div><div class="spec-doc"><p>The type for object hashes.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-commit" class="anchored"><a href="#type-commit" class="anchor"></a><code><span><span class="keyword">type</span> commit</span></code></div><div class="spec-doc"><p>Type for commit identifiers. Similar to Git's commit SHA1s.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-branch" class="anchored"><a href="#type-branch" class="anchor"></a><code><span><span class="keyword">type</span> branch</span><span> = <a href="argument-5-Branch/index.html#type-t">Branch.t</a></span></code></div><div class="spec-doc"><p>Type for persistent branch names. Branches usually share a common global namespace and it's the user's responsibility to avoid name clashes.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-slice" class="anchored"><a href="#type-slice" class="anchor"></a><code><span><span class="keyword">type</span> slice</span></code></div><div class="spec-doc"><p>Type for store slices.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-lca_error" class="anchored"><a href="#type-lca_error" class="anchor"></a><code><span><span class="keyword">type</span> lca_error</span><span> = </span><span>[ </span></code><table><tr id="type-lca_error.Max_depth_reached" class="anchored"><td class="def constructor"><a href="#type-lca_error.Max_depth_reached" class="anchor"></a><code><span>| </span></code><code><span>`Max_depth_reached</span></code></td></tr><tr id="type-lca_error.Too_many_lcas" class="anchored"><td class="def constructor"><a href="#type-lca_error.Too_many_lcas" class="anchor"></a><code><span>| </span></code><code><span>`Too_many_lcas</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for errors associated with functions computing least common ancestors</p></div></div><div class="odoc-spec"><div class="spec type" id="type-ff_error" class="anchored"><a href="#type-ff_error" class="anchor"></a><code><span><span class="keyword">type</span> ff_error</span><span> = </span><span>[ </span></code><table><tr id="type-ff_error.No_change" class="anchored"><td class="def constructor"><a href="#type-ff_error.No_change" class="anchor"></a><code><span>| </span></code><code><span>`No_change</span></code></td></tr><tr id="type-ff_error.Rejected" class="anchored"><td class="def constructor"><a href="#type-ff_error.Rejected" class="anchor"></a><code><span>| </span></code><code><span>`Rejected</span></code></td></tr><tr id="type-ff_error.lca_error" class="anchored"><td class="def type"><a href="#type-ff_error.lca_error" class="anchor"></a><code><span>| </span></code><code><span><a href="#type-lca_error">lca_error</a></span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for errors for <code>fast_forward</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Repo" class="anchored"><a href="#module-Repo" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Repo/index.html">Repo</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Repositories.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-empty" class="anchored"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>empty repo</code> is a temporary, empty store. Becomes a normal temporary store after the first update.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-master" class="anchored"><a href="#val-master" class="anchor"></a><code><span><span class="keyword">val</span> master : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>master repo</code> is a persistent store based on <code>r</code>'s master branch. This operation is cheap, can be repeated multiple times.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_branch" class="anchored"><a href="#val-of_branch" class="anchor"></a><code><span><span class="keyword">val</span> of_branch : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="#type-branch">branch</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>of_branch r name</code> is a persistent store based on the branch <code>name</code>. Similar to <code>master</code>, but use <code>name</code> instead <code>Branch</code>.S.master.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_commit" class="anchored"><a href="#val-of_commit" class="anchor"></a><code><span><span class="keyword">val</span> of_commit : <span><a href="#type-commit">commit</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>of_commit c</code> is a temporary store, based on the commit <code>c</code>.</p><p>Temporary stores do not have stable names: instead they can be addressed using the hash of the current commit. Temporary stores are similar to Git's detached heads. In a temporary store, all the operations are performed relative to the current head and update operations can modify the current head: the current stores's head will automatically become the new head obtained after performing the update.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-repo" class="anchored"><a href="#val-repo" class="anchor"></a><code><span><span class="keyword">val</span> repo : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <a href="#type-repo">repo</a></span></code></div><div class="spec-doc"><p><code>repo t</code> is the repository containing <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tree" class="anchored"><a href="#val-tree" class="anchor"></a><code><span><span class="keyword">val</span> tree : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>tree t</code> is <code>t</code>'s current tree. Contents is not allowed at the root of the tree.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Status" class="anchored"><a href="#module-Status" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Status/index.html">Status</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-status" class="anchored"><a href="#val-status" class="anchor"></a><code><span><span class="keyword">val</span> status : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <a href="Status/index.html#type-t">Status.t</a></span></code></div><div class="spec-doc"><p><code>status t</code> is <code>t</code>'s status. It can either be a branch, a commit or empty.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Head" class="anchored"><a href="#module-Head" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Head/index.html">Head</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Managing the store's heads.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Hash" class="anchored"><a href="#module-Hash" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Hash/index.html">Hash</a></span><span> : <a href="../../../irmin/Irmin/Hash/module-type-S/index.html">Irmin.Hash.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Hash/module-type-S/index.html#type-t">t</a> = <a href="#type-hash">hash</a></span></span></code></div><div class="spec-doc"><p>Object hashes.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Commit" class="anchored"><a href="#module-Commit" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Commit/index.html">Commit</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Commit</code> defines immutable objects to describe store updates.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Contents" class="anchored"><a href="#module-Contents" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Contents/index.html">Contents</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Contents</code> provides base functions for the store's contents.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Tree" class="anchored"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Tree/index.html">Tree</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Managing store's trees.</p></div></div><h2 id="reads"><a href="#reads" class="anchor"></a>Reads</h2><div class="odoc-spec"><div class="spec value" id="val-kind" class="anchored"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><span>[ `Contents <span>| `Node</span> ]</span> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>kind</code> is <a href="Tree/index.html#val-kind"><code>Tree.kind</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><span>(<a href="#type-step">step</a> * <a href="#type-tree">tree</a>)</span> list</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>list t</code> is <a href="Tree/index.html#val-list"><code>Tree.list</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mem" class="anchored"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>bool <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem t</code> is <a href="Tree/index.html#val-mem"><code>Tree.mem</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mem_tree" class="anchored"><a href="#val-mem_tree" class="anchor"></a><code><span><span class="keyword">val</span> mem_tree : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>bool <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>mem_tree t</code> is <a href="Tree/index.html#val-mem_tree"><code>Tree.mem_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_all" class="anchored"><a href="#val-find_all" class="anchor"></a><code><span><span class="keyword">val</span> find_all : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><span>(<a href="#type-contents">contents</a> * <a href="#type-metadata">metadata</a>)</span> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_all t</code> is <a href="Tree/index.html#val-find_all"><code>Tree.find_all</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-contents">contents</a> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find t</code> is <a href="Tree/index.html#val-find"><code>Tree.find</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_all" class="anchored"><a href="#val-get_all" class="anchor"></a><code><span><span class="keyword">val</span> get_all : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span>(<a href="#type-contents">contents</a> * <a href="#type-metadata">metadata</a>)</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_all t</code> is <a href="Tree/index.html#val-get_all"><code>Tree.get_all</code></a> applied on <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get" class="anchored"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-contents">contents</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get t</code> is <a href="Tree/index.html#val-get"><code>Tree.get</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_tree" class="anchored"><a href="#val-find_tree" class="anchor"></a><code><span><span class="keyword">val</span> find_tree : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>find_tree t</code> is <a href="Tree/index.html#val-find_tree"><code>Tree.find_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_tree" class="anchored"><a href="#val-get_tree" class="anchor"></a><code><span><span class="keyword">val</span> get_tree : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>get_tree t k</code> is <a href="Tree/index.html#val-get_tree"><code>Tree.get_tree</code></a> applied to <code>t</code>'s root tree.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-hash" class="anchored"><a href="#val-hash" class="anchor"></a><code><span><span class="keyword">val</span> hash : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-hash">hash</a> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>hash t k</code></p></div></div><h2 id="udpates"><a href="#udpates" class="anchor"></a>Udpates</h2><div class="odoc-spec"><div class="spec type" id="type-write_error" class="anchored"><a href="#type-write_error" class="anchor"></a><code><span><span class="keyword">type</span> write_error</span><span> = </span><span>[ </span></code><table><tr id="type-write_error.Irmin.Merge.conflict" class="anchored"><td class="def type"><a href="#type-write_error.Irmin.Merge.conflict" class="anchor"></a><code><span>| </span></code><code><span><a href="../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a></span></code></td></tr><tr id="type-write_error.Too_many_retries" class="anchored"><td class="def constructor"><a href="#type-write_error.Too_many_retries" class="anchor"></a><code><span>| </span></code><code><span>`Too_many_retries <span class="keyword">of</span> int</span></code></td></tr><tr id="type-write_error.Test_was" class="anchored"><td class="def constructor"><a href="#type-write_error.Test_was" class="anchor"></a><code><span>| </span></code><code><span>`Test_was <span class="keyword">of</span> <span><a href="#type-tree">tree</a> option</span></span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>The type for write errors.</p><ul><li>Merge conflict.</li><li>Concurrent transactions are competing to get the current operation committed and too many attemps have been tried (livelock).</li><li>A &quot;test and set&quot; operation has failed and the current value is <code>v</code> instead of the one we were waiting for.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-set" class="anchored"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-contents">contents</a> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set t k ~info v</code> sets <code>k</code> to the value <code>v</code> in <code>t</code>. Discard any previous results but ensure that no operation is lost in the history.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-set_tree"><code>set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_exn" class="anchored"><a href="#val-set_exn" class="anchor"></a><code><span><span class="keyword">val</span> set_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-contents">contents</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set_exn</code> is like <a href="#val-set"><code>set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_tree" class="anchored"><a href="#val-set_tree" class="anchor"></a><code><span><span class="keyword">val</span> set_tree : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set_tree</code> is like <a href="#val-set"><code>set</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_tree_exn" class="anchored"><a href="#val-set_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> set_tree_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>set_tree</code> is like <a href="#val-set_exn"><code>set_exn</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove" class="anchored"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove t ~info k</code> remove any bindings to <code>k</code> in <code>t</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-remove_exn" class="anchored"><a href="#val-remove_exn" class="anchor"></a><code><span><span class="keyword">val</span> remove_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>remove_exn</code> is like <a href="#val-remove"><code>remove</code></a> but raise <code>Failure _</code> instead of a using result type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-test_and_set" class="anchored"><a href="#val-test_and_set" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>test:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span>set:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>test_and_set ~test ~set</code> is like <a href="#val-set"><code>set</code></a> but it atomically checks that the tree is <code>test</code> before modifying it to <code>set</code>.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-test_and_set_tree"><code>test_and_set_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Test t)</code> if the current tree is <code>t</code> instead of <code>test</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-test_and_set_exn" class="anchored"><a href="#val-test_and_set_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a>
<span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>test:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span>set:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>test_and_set_exn</code> is like <a href="#val-test_and_set"><code>test_and_set</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-test_and_set_tree" class="anchored"><a href="#val-test_and_set_tree" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_tree : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span>
<span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>test:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span>set:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>test_and_set_tree</code> is like <a href="#val-test_and_set"><code>test_and_set</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-test_and_set_tree_exn" class="anchored"><a href="#val-test_and_set_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> test_and_set_tree_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span>
<span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>test:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span>set:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>test_and_set_tree_exn</code> is like <a href="#val-test_and_set_exn"><code>test_and_set_exn</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge" class="anchored"><a href="#val-merge" class="anchor"></a><code><span><span class="keyword">val</span> merge : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span>old:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>merge ~old</code> is like <a href="#val-set"><code>set</code></a> but merge the current tree and the new tree using <code>old</code> as ancestor in case of conflicts.</p><p>This function always uses <a href="Metadata/index.html#val-default"><code>Metadata.default</code></a> as metadata. Use <a href="#val-merge_tree"><code>merge_tree</code></a> with `<code>Contents (c, m)</code> for different ones.</p><p>The result is <code>Error (`Conflict c)</code> if the merge failed with the conflict <code>c</code>.</p><p>The result is <code>Error `Too_many_retries</code> if the concurrent operations do not allow the operation to commit to the underlying storage layer (livelock).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_exn" class="anchored"><a href="#val-merge_exn" class="anchor"></a><code><span><span class="keyword">val</span> merge_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span>old:<span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-contents">contents</a> option</span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>merge_exn</code> is like <a href="#type-merge"><code>merge</code></a> but raise <code>Failure _</code> instead of using a result type.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_tree" class="anchored"><a href="#val-merge_tree" class="anchor"></a><code><span><span class="keyword">val</span> merge_tree : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span>old:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>merge_tree</code> is like <a href="#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_tree_exn" class="anchored"><a href="#val-merge_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> merge_tree_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span>old:<span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>merge_tree</code> is like <a href="#val-merge_tree"><code>merge_tree</code></a> but for trees.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tree" class="anchored"><a href="#val-with_tree" class="anchor"></a><code><span><span class="keyword">val</span> with_tree : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span>
<span>?&#8288;strategy:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span>(<span><span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="#type-write_error">write_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>with_tree t k ~info f</code> replaces <i>atomically</i> the subtree <code>v</code> under <code>k</code> in the store <code>t</code> by the contents of the tree <code>f v</code>, using the commit info <code>info ()</code>.</p><p>If <code>v = f v</code> and <code>allow_empty</code> is unset (default) then, the operation is a no-op.</p><p>If <code>v != f v</code> and no other changes happen concurrently, <code>f v</code> becomes the new subtree under <code>k</code>. If other changes happen concurrently to that operations, the semantics depend on the value of <code>strategy</code>:</p><ul><li>if <code>strategy = `Set</code>, use <a href="#val-set"><code>set</code></a> and discard any concurrent updates to <code>k</code>.</li><li>if <code>strategy = `Test_and_set</code> (default), use <a href="#val-test_and_set"><code>test_and_set</code></a> and ensure that no concurrent operations are updating <code>k</code>.</li><li>if <code>strategy = `Merge</code>, use <a href="#type-merge"><code>merge</code></a> and ensure that concurrent updates and merged with the values present at the beginning of the transaction.</li></ul><p><b>Note:</b> Irmin transactions provides <a href="https://en.wikipedia.org/wiki/Snapshot_isolation">snapshot isolation</a> guarantees: reads and writes are isolated in every transaction, but only write conflicts are visible on commit.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_tree_exn" class="anchored"><a href="#val-with_tree_exn" class="anchor"></a><code><span><span class="keyword">val</span> with_tree_exn : <span>?&#8288;retries:int <span>&#45;&gt;</span></span> <span>?&#8288;allow_empty:bool <span>&#45;&gt;</span></span> <span>?&#8288;parents:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span>
<span>?&#8288;strategy:<span>[ `Set <span>| `Test_and_set</span> <span>| `Merge</span> ]</span> <span>&#45;&gt;</span></span> <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span>
<span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span>(<span><span><a href="#type-tree">tree</a> option</span> <span>&#45;&gt;</span></span> <span><span><a href="#type-tree">tree</a> option</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>with_tree_exn</code> is like <a href="#val-with_tree"><code>with_tree</code></a> but raise <code>Failure _</code> instead of using a return type.</p></div></div><h2 id="clones"><a href="#clones" class="anchor"></a>Clones</h2><div class="odoc-spec"><div class="spec value" id="val-clone" class="anchored"><a href="#val-clone" class="anchor"></a><code><span><span class="keyword">val</span> clone : <span>src:<a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span>dst:<a href="#type-branch">branch</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>clone ~src ~dst</code> makes <code>dst</code> points to <code>Head.get src</code>. <code>dst</code> is created if needed. Remove the current contents en <code>dst</code> if <code>src</code> is <a href="#val-empty"><code>empty</code></a>.</p></div></div><h2 id="watches"><a href="#watches" class="anchor"></a>Watches</h2><div class="odoc-spec"><div class="spec type" id="type-watch" class="anchored"><a href="#type-watch" class="anchor"></a><code><span><span class="keyword">type</span> watch</span></code></div><div class="spec-doc"><p>The type for store watches.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-watch" class="anchored"><a href="#val-watch" class="anchor"></a><code><span><span class="keyword">val</span> watch : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span>?&#8288;init:<a href="#type-commit">commit</a> <span>&#45;&gt;</span></span> <span><span>(<span><span><a href="#type-commit">commit</a> <a href="../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span></span> <span><a href="#type-watch">watch</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>watch t f</code> calls <code>f</code> every time the contents of <code>t</code>'s head is updated.</p><p><b>Note:</b> even if <code>f</code> might skip some head updates, it will never be called concurrently: all consecutive calls to <code>f</code> are done in sequence, so we ensure that the previous one ended before calling the next one.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-watch_key" class="anchored"><a href="#val-watch_key" class="anchor"></a><code><span><span class="keyword">val</span> watch_key : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span>?&#8288;init:<a href="#type-commit">commit</a> <span>&#45;&gt;</span></span> <span><span>(<span><span><span>(<a href="#type-commit">commit</a> * <a href="#type-tree">tree</a>)</span> <a href="../../../irmin/Irmin/Diff/index.html#type-t">Irmin.Diff.t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span>)</span> <span>&#45;&gt;</span></span> <span><a href="#type-watch">watch</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>watch_key t key f</code> calls <code>f</code> every time the <code>key</code>'s value is added, removed or updated. If the current branch is deleted, no signal is sent to the watcher.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unwatch" class="anchored"><a href="#val-unwatch" class="anchor"></a><code><span><span class="keyword">val</span> unwatch : <span><a href="#type-watch">watch</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>unwatch w</code> disable <code>w</code>. Return once the <code>w</code> is fully disabled.</p></div></div><h2 id="merges-and-common-ancestors."><a href="#merges-and-common-ancestors." class="anchor"></a>Merges and Common Ancestors.</h2><div class="odoc-spec"><div class="spec type" id="type-merge" class="anchored"><a href="#type-merge" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a merge</span></span><span> = <span>info:<a href="../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span>&#45;&gt;</span></span> <span>?&#8288;max_depth:int <span>&#45;&gt;</span></span> <span>?&#8288;n:int <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span><span><span>(unit,Â <a href="../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>The type for merge functions.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_into" class="anchored"><a href="#val-merge_into" class="anchor"></a><code><span><span class="keyword">val</span> merge_into : <span>into:<a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p><code>merge_into ~into i t</code> merges <code>t</code>'s current branch into <code>x</code>'s current branch using the info <code>i</code>. After that operation, the two stores are still independent. Similar to <code>git merge &lt;branch&gt;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_with_branch" class="anchored"><a href="#val-merge_with_branch" class="anchor"></a><code><span><span class="keyword">val</span> merge_with_branch : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-branch">branch</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#type-merge"><code>merge</code></a> but with a branch ID.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_with_commit" class="anchored"><a href="#val-merge_with_commit" class="anchor"></a><code><span><span class="keyword">val</span> merge_with_commit : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-commit">commit</a> <a href="#type-merge">merge</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#type-merge"><code>merge</code></a> but with a commit ID.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lcas" class="anchored"><a href="#val-lcas" class="anchor"></a><code><span><span class="keyword">val</span> lcas : <span>?&#8288;max_depth:int <span>&#45;&gt;</span></span> <span>?&#8288;n:int <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><span><span>(<span><a href="#type-commit">commit</a> list</span>,Â <a href="#type-lca_error">lca_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>lca ?max_depth ?n msg t1 t2</code> returns the collection of least common ancestors between the heads of <code>t1</code> and <code>t2</code> branches.</p><ul><li><code>max_depth</code> is the maximum depth of the exploration (default is <code>max_int</code>). Return <code>Error `Max_depth_reached</code> if this depth is exceeded.</li><li><code>n</code> is the maximum expected number of lcas. Stop the exploration as soon as <code>n</code> lcas are found. Return <code>Error `Too_many_lcas</code> if more <code>lcas</code> are found.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-lcas_with_branch" class="anchored"><a href="#val-lcas_with_branch" class="anchor"></a><code><span><span class="keyword">val</span> lcas_with_branch : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span>?&#8288;max_depth:int <span>&#45;&gt;</span></span> <span>?&#8288;n:int <span>&#45;&gt;</span></span> <span><a href="#type-branch">branch</a> <span>&#45;&gt;</span></span> <span><span><span>(<span><a href="#type-commit">commit</a> list</span>,Â <a href="#type-lca_error">lca_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-lcas"><code>lcas</code></a> but takes a branch ID as argument.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lcas_with_commit" class="anchored"><a href="#val-lcas_with_commit" class="anchor"></a><code><span><span class="keyword">val</span> lcas_with_commit : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span>?&#8288;max_depth:int <span>&#45;&gt;</span></span> <span>?&#8288;n:int <span>&#45;&gt;</span></span> <span><a href="#type-commit">commit</a> <span>&#45;&gt;</span></span> <span><span><span>(<span><a href="#type-commit">commit</a> list</span>,Â <a href="#type-lca_error">lca_error</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-lcas"><code>lcas</code></a> but takes a commit ID as argument.</p></div></div><h2 id="history"><a href="#history" class="anchor"></a>History</h2><div class="odoc-spec"><div class="spec module" id="module-History" class="anchored"><a href="#module-History" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="History/index.html">History</a></span><span> : <a href="../../../ocamlgraph/Graph/Sig/module-type-P/index.html">Graph.Sig.P</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../ocamlgraph/Graph/Sig/module-type-P/V/index.html#type-t">V.t</a> = <a href="#type-commit">commit</a></span></span></code></div><div class="spec-doc"><p>An history is a DAG of heads.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-history" class="anchored"><a href="#val-history" class="anchor"></a><code><span><span class="keyword">val</span> history : <span>?&#8288;depth:int <span>&#45;&gt;</span></span> <span>?&#8288;min:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>?&#8288;max:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="History/index.html#type-t">History.t</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>history ?depth ?min ?max t</code> is a view of the history of the store <code>t</code>, of depth at most <code>depth</code>, starting from the <code>t</code>'s head (or from <code>max</code> if the head is not set) and stopping at <code>min</code> if specified.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-last_modified" class="anchored"><a href="#val-last_modified" class="anchor"></a><code><span><span class="keyword">val</span> last_modified : <span>?&#8288;depth:int <span>&#45;&gt;</span></span> <span>?&#8288;n:int <span>&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span><a href="#type-key">key</a> <span>&#45;&gt;</span></span> <span><span><a href="#type-commit">commit</a> list</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>last_modified ?number c k</code> is the list of the last <code>number</code> commits that modified <code>key</code>, in ascending order of date. <code>depth</code> is the maximum depth to be explored in the commit graph, if any. Default value for <code>number</code> is 1.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Branch" class="anchored"><a href="#module-Branch" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Branch/index.html">Branch</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Manipulate branches.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Key" class="anchored"><a href="#module-Key" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Key/index.html">Key</a></span><span> : <a href="../../../irmin/Irmin/Path/module-type-S/index.html">Irmin.Path.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Path/module-type-S/index.html#type-t">t</a> = <a href="#type-key">key</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Path/module-type-S/index.html#type-step">step</a> = <a href="#type-step">step</a></span> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../../irmin/Irmin/Path/module-type-S/index.html#type-step">step</a> = <a href="argument-4-Path/index.html#type-step">Path.step</a></span></span></code></div><div class="spec-doc"><p><code>Key</code> provides base functions for the stores's paths.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Metadata" class="anchored"><a href="#module-Metadata" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Metadata/index.html">Metadata</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Metadata</code> provides base functions for node metadata.</p></div></div><h2 id="value-types"><a href="#value-types" class="anchor"></a>Value Types</h2><div class="odoc-spec"><div class="spec value" id="val-step_t" class="anchored"><a href="#val-step_t" class="anchor"></a><code><span><span class="keyword">val</span> step_t : <span><a href="#type-step">step</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>step_t</code> is the value type for <a href="#type-step"><code>step</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-key_t" class="anchored"><a href="#val-key_t" class="anchor"></a><code><span><span class="keyword">val</span> key_t : <span><a href="#type-key">key</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>key_t</code> is the value type for <a href="#type-key"><code>key</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-metadata_t" class="anchored"><a href="#val-metadata_t" class="anchor"></a><code><span><span class="keyword">val</span> metadata_t : <span><a href="#type-metadata">metadata</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>metadata_t</code> is the value type for <a href="#type-metadata"><code>metadata</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-contents_t" class="anchored"><a href="#val-contents_t" class="anchor"></a><code><span><span class="keyword">val</span> contents_t : <span><a href="#type-contents">contents</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>contents_t</code> is the value type for <a href="#type-contents"><code>contents</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-node_t" class="anchored"><a href="#val-node_t" class="anchor"></a><code><span><span class="keyword">val</span> node_t : <span><a href="#type-node">node</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>node_t</code> is the value type for <a href="#type-node"><code>node</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tree_t" class="anchored"><a href="#val-tree_t" class="anchor"></a><code><span><span class="keyword">val</span> tree_t : <span><a href="#type-tree">tree</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>tree_t</code> is the value type for <a href="#val-tree"><code>tree</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-commit_t" class="anchored"><a href="#val-commit_t" class="anchor"></a><code><span><span class="keyword">val</span> commit_t : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="#type-commit">commit</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>commit_t r</code> is the value type for <a href="#type-commit"><code>commit</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-branch_t" class="anchored"><a href="#val-branch_t" class="anchor"></a><code><span><span class="keyword">val</span> branch_t : <span><a href="#type-branch">branch</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>branch_t</code> is the value type for <a href="#type-branch"><code>branch</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-slice_t" class="anchored"><a href="#val-slice_t" class="anchor"></a><code><span><span class="keyword">val</span> slice_t : <span><a href="#type-slice">slice</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>slice_t</code> is the value type for <a href="#type-slice"><code>slice</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-kind_t" class="anchored"><a href="#val-kind_t" class="anchor"></a><code><span><span class="keyword">val</span> kind_t : <span><span>[ `Contents <span>| `Node</span> ]</span> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>kind_t</code> is the value type for values returned by <a href="#val-kind"><code>kind</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lca_error_t" class="anchored"><a href="#val-lca_error_t" class="anchor"></a><code><span><span class="keyword">val</span> lca_error_t : <span><a href="#type-lca_error">lca_error</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>lca_error_t</code> is the value type for <a href="#type-lca_error"><code>lca_error</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ff_error_t" class="anchored"><a href="#val-ff_error_t" class="anchor"></a><code><span><span class="keyword">val</span> ff_error_t : <span><a href="#type-ff_error">ff_error</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>ff_error_t</code> is the value type for <a href="#type-ff_error"><code>ff_error</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_error_t" class="anchored"><a href="#val-write_error_t" class="anchor"></a><code><span><span class="keyword">val</span> write_error_t : <span><a href="#type-write_error">write_error</a> <a href="../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></span></span></code></div><div class="spec-doc"><p><code>write_error_t</code> is the value type for <a href="#type-write_error"><code>write_error</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Private" class="anchored"><a href="#module-Private" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Private/index.html">Private</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Private functions, which might be used by the backends.</p></div></div><div class="odoc-spec"><div class="spec extension"><code><span><span class="keyword">type</span> <span class="xref-unresolved">Irmin__S.remote</span> += </span></code><table><tr id="extension-E" class="anchored"><td class="def extension"><a href="#extension-E" class="anchor"></a><code><span>| </span><span><span class="extension">E</span> <span class="keyword">of</span> <a href="Private/Sync/index.html#type-endpoint">Private.Sync.endpoint</a></span></code></td><td class="doc"><p>Extend the <code>remote</code> type with <code>endpoint</code>.</p></td></tr></table></div></div><h3 id="converters-to-private-types"><a href="#converters-to-private-types" class="anchor"></a>Converters to private types</h3><div class="odoc-spec"><div class="spec value" id="val-to_private_node" class="anchored"><a href="#val-to_private_node" class="anchor"></a><code><span><span class="keyword">val</span> to_private_node : <span><a href="#type-node">node</a> <span>&#45;&gt;</span></span> <span><span><a href="Private/Node/index.html#type-value">Private.Node.value</a> <a href="Tree/index.html#type-or_error">Tree.or_error</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-of_private_node" class="anchored"><a href="#val-of_private_node" class="anchor"></a><code><span><span class="keyword">val</span> of_private_node : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="Private/Node/index.html#type-value">Private.Node.value</a> <span>&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-to_private_commit" class="anchored"><a href="#val-to_private_commit" class="anchor"></a><code><span><span class="keyword">val</span> to_private_commit : <span><a href="#type-commit">commit</a> <span>&#45;&gt;</span></span> <a href="Private/Commit/index.html#type-value">Private.Commit.value</a></span></code></div><div class="spec-doc"><p><code>to_private_commit c</code> is the private commit object associated with the commit <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_private_commit" class="anchored"><a href="#val-of_private_commit" class="anchor"></a><code><span><span class="keyword">val</span> of_private_commit : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="Private/Commit/index.html#type-value">Private.Commit.value</a> <span>&#45;&gt;</span></span> <a href="#type-commit">commit</a></span></code></div><div class="spec-doc"><p><code>of_private_commit r c</code> is the commit associated with the private commit object <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-save_contents" class="anchored"><a href="#val-save_contents" class="anchor"></a><code><span><span class="keyword">val</span> save_contents : <span><span><span>[&gt; <a href="../../../irmin/Irmin/Perms/index.html#type-write">Irmin.Perms.write</a> ]</span> <a href="Private/Contents/index.html#type-t">Private.Contents.t</a></span> <span>&#45;&gt;</span></span> <span><a href="#type-contents">contents</a> <span>&#45;&gt;</span></span> <span><a href="#type-hash">hash</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Save a content into the database</p></div></div><div class="odoc-spec"><div class="spec value" id="val-save_tree" class="anchored"><a href="#val-save_tree" class="anchor"></a><code><span><span class="keyword">val</span> save_tree : <span>?&#8288;clear:bool <span>&#45;&gt;</span></span> <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><span><span>[&gt; <a href="../../../irmin/Irmin/Perms/index.html#type-write">Irmin.Perms.write</a> ]</span> <a href="Private/Contents/index.html#type-t">Private.Contents.t</a></span> <span>&#45;&gt;</span></span> <span><span><span>[&gt; <a href="../../../irmin/Irmin/Perms/index.html#type-read_write">Irmin.Perms.read_write</a> ]</span> <a href="Private/Node/index.html#type-t">Private.Node.t</a></span> <span>&#45;&gt;</span></span> <span><a href="#type-tree">tree</a> <span>&#45;&gt;</span></span> <span><a href="#type-hash">hash</a> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p>Save a tree into the database. Does not do any reads. If <code>clear</code> is set (it is by default), the tree cache will be cleared after the save.</p></div></div></div></div></div></details></div></div></div><div class="odoc-spec"><div class="spec value" id="val-freeze" class="anchored"><a href="#val-freeze" class="anchor"></a><code><span><span class="keyword">val</span> freeze : <span>?&#8288;min:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>?&#8288;max:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>?&#8288;squash:bool <span>&#45;&gt;</span></span> <span>?&#8288;copy_in_upper:bool <span>&#45;&gt;</span></span>
<span>?&#8288;min_upper:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>?&#8288;recovery:bool <span>&#45;&gt;</span></span> <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>freeze ?min ?max ?squash ?copy_in_upper ?min_upper ?recovery t</code> launches an asynchronous freezing operation on the repo <code>t</code> to reduce the size of the upper layer and discard unnecessary branches of objects (i.e. commits, nodes and contents).</p><p>Let <code>o</code> be the set of objects reachable from the <code>max</code> commits and bounded by the <code>min</code> commits. During the freeze, all objects in <code>o</code> are copied to the lower layer, if there is one. Setting <code>squash</code> to <code>true</code> is equivalent to setting <code>min</code> to <code>max</code>. <code>min</code> defaults to the empty list and <code>max</code> defaults to the head commits of the repo.</p><p>Let <code>o'</code> be the set of objects reachable from the <code>max</code> commits and bounded by the <code>min_upper</code> commits. When the freeze is over, if <code>copy_in_upper</code> is true, then the new upper layer will only contain the objects of <code>o'</code>, otherwise the new upper layer will be empty. <code>min_upper</code> defaults to the empty list and <code>copy_in_upper</code> defaults to the repo's configuration.</p><p>If <code>recovery</code> is true then the function will first try to recover from a previously interrupted freeze. See <a href="#val-needs_recovery"><code>needs_recovery</code></a>.</p><p>If a freeze is already ongoing, the behavior depends on the freeze_throttle configuration of the repo:</p><ul><li>When <code>`Overcommit_memory</code>, the function returns without launching a new freeze.</li><li>When <code>`Cancel_existing</code>, the function blocks until the ongoing freeze safely cancels and then a new one is started afterwards. The time spent doing the canceled freeze is not completely wasted, objects copied to the lower layer will not have to be copied again, but objects copied to the next upper layer are discarded from that layer.</li><li>When <code>`Block_writes</code>, the function blocks until the ongoing freeze ends and then a new one is started afterwards.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-store_handle" class="anchored"><a href="#type-store_handle" class="anchor"></a><code><span><span class="keyword">type</span> store_handle</span><span> = </span></code><table><tr id="type-store_handle.Commit_t" class="anchored"><td class="def variant constructor"><a href="#type-store_handle.Commit_t" class="anchor"></a><code><span>| </span><span><span class="constructor">Commit_t</span> : <a href="#type-hash">hash</a> <span>&#45;&gt;</span> <a href="#type-store_handle">store_handle</a></span></code></td></tr><tr id="type-store_handle.Node_t" class="anchored"><td class="def variant constructor"><a href="#type-store_handle.Node_t" class="anchor"></a><code><span>| </span><span><span class="constructor">Node_t</span> : <a href="#type-hash">hash</a> <span>&#45;&gt;</span> <a href="#type-store_handle">store_handle</a></span></code></td></tr><tr id="type-store_handle.Content_t" class="anchored"><td class="def variant constructor"><a href="#type-store_handle.Content_t" class="anchor"></a><code><span>| </span><span><span class="constructor">Content_t</span> : <a href="#type-hash">hash</a> <span>&#45;&gt;</span> <a href="#type-store_handle">store_handle</a></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-layer_id" class="anchored"><a href="#val-layer_id" class="anchor"></a><code><span><span class="keyword">val</span> layer_id : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><a href="#type-store_handle">store_handle</a> <span>&#45;&gt;</span></span> <span><span>[ `Upper0 <span>| `Upper1</span> <span>| `Lower</span> ]</span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>layer_id t store_handle</code> returns the layer where an object, identified by its hash, is stored.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-async_freeze" class="anchored"><a href="#val-async_freeze" class="anchor"></a><code><span><span class="keyword">val</span> async_freeze : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>async_freeze t</code> returns true if there is an ongoing freeze. To be used with caution, as a freeze can start (or stop) just after the test. It is helpful when a single freeze is called, to check whether it completed or not.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-self_contained" class="anchored"><a href="#val-self_contained" class="anchor"></a><code><span><span class="keyword">val</span> self_contained : <span>?&#8288;min:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span>max:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span> <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>self_contained min max t</code> copies the commits in the range of <code>min, max</code> from lower into upper, in order to make the upper self contained. If <code>min</code> is missing then only the <code>max</code> commits are copied.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_self_contained" class="anchored"><a href="#val-check_self_contained" class="anchor"></a><code><span><span class="keyword">val</span> check_self_contained : <span>?&#8288;heads:<span><a href="#type-commit">commit</a> list</span> <span>&#45;&gt;</span></span>
<span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><span><span>(<span>[&gt; <span>`Msg of string</span> ]</span>,Â <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>check_self_contained ?heads</code> checks that the current upper layer of a store is self contained.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-needs_recovery" class="anchored"><a href="#val-needs_recovery" class="anchor"></a><code><span><span class="keyword">val</span> needs_recovery : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>needs_recovery repo</code> detects if an ongoing freeze was interrupted during the last node crash. If it returns <code>true</code> then the next call to freeze needs to have its <code>recovery</code> flag set.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-PrivateLayer" class="anchored"><a href="#module-PrivateLayer" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="PrivateLayer/index.html">PrivateLayer</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>These modules should not be used. They are exposed purely for testing purposes.</p></div></div></details></div></div></div><div class="odoc-include"><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span><span class="keyword">include</span> <a href="../../Irmin_pack/Store/module-type-S/index.html">Irmin_pack.Store.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Irmin_pack/Store/module-type-S/index.html#type-repo">repo</a> := <a href="#type-repo">repo</a></span></span></code></span></summary><div class="odoc-spec"><div class="spec value" id="val-integrity_check" class="anchored"><a href="#val-integrity_check" class="anchor"></a><code><span><span class="keyword">val</span> integrity_check : <span>?&#8288;ppf:<a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span>auto_repair:bool <span>&#45;&gt;</span></span>
<span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><span>(<span>[&gt; <span>`Fixed of int</span> <span>| `No_error</span> ]</span>,Â <span>[&gt; <span>`Cannot_fix of string</span> <span><span>| `Corrupted</span> of int</span> ]</span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></span></code></div><div class="spec-doc"><p>Checks the integrity of the repository. if <code>auto_repair</code> is <code>true</code>, will also try to fix the issues. <code>ppf</code> is a formatter for progressive reporting. <code>`Fixed</code> and <code>`Corrupted</code> report the number of fixed/corrupted entries.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-sync" class="anchored"><a href="#val-sync" class="anchor"></a><code><span><span class="keyword">val</span> sync : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>sync t</code> syncs a readonly pack with the files on disk. Raises <code>invalid_argument</code> if called by a read-write pack.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-clear" class="anchored"><a href="#val-clear" class="anchor"></a><code><span><span class="keyword">val</span> clear : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span>unit <a href="../../../lwt/Lwt/index.html#type-t">Lwt.t</a></span></span></code></div><div class="spec-doc"><p><code>clear t</code> removes all the data persisted in <code>t</code>. This operations provides snapshot isolation guarantees for read-only instances: read-only instance will continue to see all the data until they explicitely call <a href="#val-sync"><code>sync</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-migrate" class="anchored"><a href="#val-migrate" class="anchor"></a><code><span><span class="keyword">val</span> migrate : <span><a href="../../../irmin/Irmin/index.html#type-config">Irmin.config</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>migrate conf</code> upgrades the repository with configuration <code>conf</code> to use the latest storage format.</p><p><b>Note:</b> performing concurrent store operations during the migration, or attempting to use pre-migration instances of the repository after the migration is complete, will result in undefined behaviour.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-flush" class="anchored"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>flush t</code> flush read-write pack on disk. Raises <code>RO_Not_Allowed</code> if called by a readonly instance.</p></div></div></details></div></div></div><div class="odoc-spec"><div class="spec value" id="val-integrity_check" class="anchored"><a href="#val-integrity_check" class="anchor"></a><code><span><span class="keyword">val</span> integrity_check : <span>?&#8288;ppf:<a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span>auto_repair:bool <span>&#45;&gt;</span></span>
<span><a href="#type-repo">repo</a> <span>&#45;&gt;</span></span> <span><span>(<span><span>(<span>[&gt; <span>`Fixed of int</span> <span>| `No_error</span> ]</span>,Â <span>[&gt; <span>`Cannot_fix of string</span> <span><span>| `Corrupted</span> of int</span> ]</span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> * <a href="../../../irmin-layers/Irmin_layers/Layer_id/index.html#type-t">Irmin_layers.Layer_id.t</a>)</span> list</span></span></code></div></div></div></div></div></div></body></html>