<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PPrintEngine (pprint.PPrintEngine)</title><link rel="stylesheet" href="../../odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">pprint</a> &#x00BB; PPrintEngine</nav><header class="odoc-preamble"><h1>Module <code><span>PPrintEngine</span></code></h1><p>A pretty-printing engine and a set of basic document combinators.</p></header><nav class="odoc-toc"><ul><li><a href="#building-documents">Building documents</a></li><li><a href="#rendering-documents">Rendering documents</a></li><li><a href="#defining-custom-documents">Defining custom documents</a></li></ul></nav><div class="odoc-content"><h2 id="building-documents"><a href="#building-documents" class="anchor"></a>Building documents</h2><p>Documents must be built in memory before they are rendered. This may seem costly, but it is a simple approach, and works well.</p><p>The following operations form a set of basic (low-level) combinators for building documents. On top of these combinators, higher-level combinators can be defined: see <a href="../PPrintCombinators/index.html"><code>PPrintCombinators</code></a>.</p><div class="odoc-spec"><div class="spec type" id="type-document" class="anchored"><a href="#type-document" class="anchor"></a><code><span><span class="keyword">type</span> document</span></code></div><div class="spec-doc"><p>This is the abstract type of documents.</p></div></div><p>The following basic (low-level) combinators allow constructing documents.</p><div class="odoc-spec"><div class="spec value" id="val-empty" class="anchored"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>empty</code> is the empty document.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-char" class="anchored"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">val</span> char : <span>char <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>char c</code> is a document that consists of the single character <code>c</code>. This character must not be a newline.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>string s</code> is a document that consists of the string <code>s</code>. This string must not contain a newline.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-substring" class="anchored"><a href="#val-substring" class="anchor"></a><code><span><span class="keyword">val</span> substring : <span>string <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>substring s ofs len</code> is a document that consists of the portion of the string <code>s</code> delimited by the offset <code>ofs</code> and the length <code>len</code>. This portion must not contain a newline.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fancystring" class="anchored"><a href="#val-fancystring" class="anchor"></a><code><span><span class="keyword">val</span> fancystring : <span>string <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>fancystring s apparent_length</code> is a document that consists of the string <code>s</code>. This string must not contain a newline. The string may contain fancy characters: color escape characters, UTF-8 or multi-byte characters, etc. Thus, its apparent length (which measures how many columns the text will take up on screen) differs from its length in bytes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fancysubstring" class="anchored"><a href="#val-fancysubstring" class="anchor"></a><code><span><span class="keyword">val</span> fancysubstring : <span>string <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>fancysubstring s ofs len apparent_length</code> is a document that consists of the portion of the string <code>s</code> delimited by the offset <code>ofs</code> and the length <code>len</code>. This portion must contain a newline. The string may contain fancy characters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-utf8string" class="anchored"><a href="#val-utf8string" class="anchor"></a><code><span><span class="keyword">val</span> utf8string : <span>string <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>utf8string s</code> is a document that consists of the UTF-8-encoded string <code>s</code>. This string must not contain a newline.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-utf8format" class="anchored"><a href="#val-utf8format" class="anchor"></a><code><span><span class="keyword">val</span> utf8format : <span><span><span>(<span class="type-var">'a</span>, unit, string, <a href="#type-document">document</a>)</span> <a href="../../ocaml/Stdlib/index.html#type-format4">Stdlib.format4</a></span> <span>&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>utf8format format &lt;args&gt;...</code> is equivalent to <code>utf8string (Printf.sprintf format &lt;args&gt;...)</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-hardline" class="anchored"><a href="#val-hardline" class="anchor"></a><code><span><span class="keyword">val</span> hardline : <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>hardline</code> is a forced newline document. This document forces all enclosing groups to be printed in non-flattening mode. In other words, any enclosing groups are dissolved.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-blank" class="anchored"><a href="#val-blank" class="anchor"></a><code><span><span class="keyword">val</span> blank : <span>int <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>blank n</code> is a document that consists of <code>n</code> blank characters.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-break" class="anchored"><a href="#val-break" class="anchor"></a><code><span><span class="keyword">val</span> break : <span>int <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>break n</code> is a document which consists of either <code>n</code> blank characters, when forced to display on a single line, or a single newline character, otherwise. Note that there is no choice at this point: choices are encoded by the <code>group</code> combinator.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(^^)" class="anchored"><a href="#val-(^^)" class="anchor"></a><code><span><span class="keyword">val</span> (^^) : <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>doc1 ^^ doc2</code> is the concatenation of the documents <code>doc1</code> and <code>doc2</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nest" class="anchored"><a href="#val-nest" class="anchor"></a><code><span><span class="keyword">val</span> nest : <span>int <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>nest j doc</code> is the document <code>doc</code>, in which the indentation level has been increased by <code>j</code>, that is, in which <code>j</code> blanks have been inserted after every newline character. Read this again: indentation is inserted after every newline character. No indentation is inserted at the beginning of the document.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-group" class="anchored"><a href="#val-group" class="anchor"></a><code><span><span class="keyword">val</span> group : <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>group doc</code> encodes a choice. If possible, then the entire document <code>group
    doc</code> is rendered on a single line. Otherwise, the group is dissolved, and <code>doc</code> is rendered. There might be further groups within <code>doc</code>, whose presence will lead to further choices being explored.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ifflat" class="anchored"><a href="#val-ifflat" class="anchor"></a><code><span><span class="keyword">val</span> ifflat : <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>ifflat doc1 doc2</code> is rendered as <code>doc1</code> if part of a group that can be successfully flattened, and is rendered as <code>doc2</code> otherwise. Use this operation with caution. Because the pretty-printer is free to choose between <code>doc1</code> and <code>doc2</code>, these documents should be semantically equivalent.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-align" class="anchored"><a href="#val-align" class="anchor"></a><code><span><span class="keyword">val</span> align : <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>align doc</code> is the document <code>doc</code>, in which the indentation level has been set to the current column. Thus, <code>doc</code> is rendered within a box whose upper left corner is the current position.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-point" class="anchored"><a href="#type-point" class="anchor"></a><code><span><span class="keyword">type</span> point</span><span> = int * int</span></code></div><div class="spec-doc"><p>A point is a pair of a line number and a column number.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-range" class="anchored"><a href="#type-range" class="anchor"></a><code><span><span class="keyword">type</span> range</span><span> = <a href="#type-point">point</a> * <a href="#type-point">point</a></span></code></div><div class="spec-doc"><p>A range is a pair of points.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-range" class="anchored"><a href="#val-range" class="anchor"></a><code><span><span class="keyword">val</span> range : <span><span>(<span><a href="#type-range">range</a> <span>&#45;&gt;</span></span> unit)</span> <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p><code>range hook doc</code> is printed exactly like the document <code>doc</code>, but allows the caller to register a hook that is applied, when the document is printed, to the range occupied by this document in the output text. This offers a way of mapping positions in the output text back to (sub)documents.</p></div></div><h2 id="rendering-documents"><a href="#rendering-documents" class="anchor"></a>Rendering documents</h2><div class="odoc-spec"><div class="spec module" id="module-ToChannel" class="anchored"><a href="#module-ToChannel" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="ToChannel/index.html">ToChannel</a></span><span> : <a href="../PPrintRenderer/module-type-RENDERER/index.html">PPrintRenderer.RENDERER</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-channel">channel</a> = <a href="../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-document">document</a> = <a href="#type-document">document</a></span></span></code></div><div class="spec-doc"><p>This renderer sends its output into an output channel.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-ToBuffer" class="anchored"><a href="#module-ToBuffer" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="ToBuffer/index.html">ToBuffer</a></span><span> : <a href="../PPrintRenderer/module-type-RENDERER/index.html">PPrintRenderer.RENDERER</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-channel">channel</a> = <a href="../../ocaml/Stdlib/Buffer/index.html#type-t">Stdlib.Buffer.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-document">document</a> = <a href="#type-document">document</a></span></span></code></div><div class="spec-doc"><p>This renderer sends its output into a memory buffer.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-ToFormatter" class="anchored"><a href="#module-ToFormatter" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="ToFormatter/index.html">ToFormatter</a></span><span> : <a href="../PPrintRenderer/module-type-RENDERER/index.html">PPrintRenderer.RENDERER</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-channel">channel</a> = <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../PPrintRenderer/module-type-RENDERER/index.html#type-document">document</a> = <a href="#type-document">document</a></span></span></code></div><div class="spec-doc"><p>This renderer sends its output into a formatter channel.</p></div></div><h2 id="defining-custom-documents"><a href="#defining-custom-documents" class="anchor"></a>Defining custom documents</h2><p>A width requirement is expressed as an integer, where the value <code>max_int</code> is reserved and represents infinity.</p><div class="odoc-spec"><div class="spec type" id="type-requirement" class="anchored"><a href="#type-requirement" class="anchor"></a><code><span><span class="keyword">type</span> requirement</span><span> = int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-infinity" class="anchored"><a href="#val-infinity" class="anchor"></a><code><span><span class="keyword">val</span> infinity : <a href="#type-requirement">requirement</a></span></code></div></div><p>An output channel is represented abstractly as an object equipped with methods for displaying one character and for displaying a substring.</p><div class="odoc-spec"><div class="spec class-type" id="class-type-output" class="anchored"><a href="#class-type-output" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">type</span>  </span><span><a href="class-type-output/index.html">output</a></span><span> = <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><p>The rendering engine maintains the following internal state. Its structure is subject to change in future versions of the library. Nevertheless, it is exposed to the user who wishes to define custom documents.</p><div class="odoc-spec"><div class="spec type" id="type-state" class="anchored"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = </span><span>{</span></code><table><tr id="type-state.width" class="anchored"><td class="def record field"><a href="#type-state.width" class="anchor"></a><code><span>width : int;</span></code></td><td class="doc"><p>The line width. This parameter is fixed throughout the execution of the renderer.</p></td></tr><tr id="type-state.ribbon" class="anchored"><td class="def record field"><a href="#type-state.ribbon" class="anchor"></a><code><span>ribbon : int;</span></code></td><td class="doc"><p>The ribbon width. This parameter is fixed throughout the execution of the renderer.</p></td></tr><tr id="type-state.last_indent" class="anchored"><td class="def record field"><a href="#type-state.last_indent" class="anchor"></a><code><span><span class="keyword">mutable</span> last_indent : int;</span></code></td><td class="doc"><p>The number of blanks that were printed at the beginning of the current line. This field is updated (only) when a hardline is emitted. It is used (only) to determine whether the ribbon width constraint is respected.</p></td></tr><tr id="type-state.line" class="anchored"><td class="def record field"><a href="#type-state.line" class="anchor"></a><code><span><span class="keyword">mutable</span> line : int;</span></code></td><td class="doc"><p>The current line. This field is updated (only) when a hardline is emitted. It is not used by the pretty-printing engine itself.</p></td></tr><tr id="type-state.column" class="anchored"><td class="def record field"><a href="#type-state.column" class="anchor"></a><code><span><span class="keyword">mutable</span> column : int;</span></code></td><td class="doc"><p>The current column. This field must be updated whenever something is sent to the output channel. It is used (only) to determine whether the width constraint is respected.</p></td></tr></table><code><span>}</span></code></div></div><p>A custom document is defined by implementing the following methods.</p><div class="odoc-spec"><div class="spec class-type" id="class-type-custom" class="anchored"><a href="#class-type-custom" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">type</span>  </span><span><a href="class-type-custom/index.html">custom</a></span><span> = <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-custom" class="anchored"><a href="#val-custom" class="anchor"></a><code><span><span class="keyword">val</span> custom : <span><a href="class-type-custom/index.html">custom</a> <span>&#45;&gt;</span></span> <a href="#type-document">document</a></span></code></div><div class="spec-doc"><p>The function <code>custom</code> constructs a custom document. In other words, it converts an object of type <code>custom</code> to a document.</p></div></div><p>The key functions of the library are exposed, in the hope that they may be useful to authors of custom (leaf and non-leaf) documents. In the case of a leaf document, they can help perform certain basic functions; for instance, applying the function <code>pretty</code> to the document <code>hardline</code> is a simple way of printing a hardline, while respecting the indentation parameters and updating the state in a correct manner. Similarly, applying <code>pretty</code> to the document <code>blank n</code> is a simple way of printing <code>n</code> spaces. In the case of a non-leaf document (i.e., one which contains sub-documents), these functions are essential: they allow computing the width requirement of a sub-document and displaying a sub-document.</p><div class="odoc-spec"><div class="spec value" id="val-requirement" class="anchored"><a href="#val-requirement" class="anchor"></a><code><span><span class="keyword">val</span> requirement : <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> <a href="#type-requirement">requirement</a></span></code></div><div class="spec-doc"><p><code>requirement doc</code> computes the width requirement of the document <code>doc</code>. It works in constant time.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pretty" class="anchored"><a href="#val-pretty" class="anchor"></a><code><span><span class="keyword">val</span> pretty : <span><a href="class-type-output/index.html">output</a> <span>&#45;&gt;</span></span> <span><a href="#type-state">state</a> <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span>bool <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pretty output state indent flatten doc</code> prints the document <code>doc</code>. See the documentation of the method <code>pretty</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-compact" class="anchored"><a href="#val-compact" class="anchor"></a><code><span><span class="keyword">val</span> compact : <span><a href="class-type-output/index.html">output</a> <span>&#45;&gt;</span></span> <span><a href="#type-document">document</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>compact output doc</code> prints the document <code>doc</code>. See the documentation of the method <code>compact</code>.</p></div></div></div></body></html>