<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Encoding (data-encoding.Data_encoding.Encoding)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">data-encoding</a> &#x00BB; <a href="../index.html">Data_encoding</a> &#x00BB; Encoding</nav><header class="odoc-preamble"><h1>Module <code><span>Data_encoding.Encoding</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#ground-descriptors">Ground descriptors</a></li><li><a href="#descriptor-combinators">Descriptor combinators</a></li><li><a href="#product-descriptors">Product descriptors</a><ul><li><a href="#constructors-for-objects-with-n-fields">Constructors for objects with N fields</a></li><li><a href="#constructors-for-tuples-with-n-fields">Constructors for tuples with N fields</a></li></ul></li><li><a href="#sum-descriptors">Sum descriptors</a></li><li><a href="#predicates-over-descriptors">Predicates over descriptors</a></li><li><a href="#specialized-descriptors">Specialized descriptors</a></li><li><a href="#documenting-descriptors">Documenting descriptors</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The type descriptors for values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-encoding" class="anchored"><a href="#type-encoding" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a encoding</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><h4 id="ground-descriptors"><a href="#ground-descriptors" class="anchor"></a>Ground descriptors</h4><div class="odoc-spec"><div class="spec value" id="val-null" class="anchored"><a href="#val-null" class="anchor"></a><code><span><span class="keyword">val</span> null : <span>unit <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Special value <code>null</code> in JSON, nothing in binary.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-empty" class="anchored"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <span>unit <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Empty object (not included in binary, encoded as empty object in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unit" class="anchored"><a href="#val-unit" class="anchor"></a><code><span><span class="keyword">val</span> unit : <span>unit <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Unit value, omitted in binary. Serialized as an empty object in JSON, accepts any object when deserializing.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-constant" class="anchored"><a href="#val-constant" class="anchor"></a><code><span><span class="keyword">val</span> constant : <span>string <span>&#45;&gt;</span></span> <span>unit <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Constant string (data is not included in the binary data).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int8" class="anchored"><a href="#val-int8" class="anchor"></a><code><span><span class="keyword">val</span> int8 : <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Signed 8 bit integer (data is encoded as a byte in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-uint8" class="anchored"><a href="#val-uint8" class="anchor"></a><code><span><span class="keyword">val</span> uint8 : <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Unsigned 8 bit integer (data is encoded as a byte in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int16" class="anchored"><a href="#val-int16" class="anchor"></a><code><span><span class="keyword">val</span> int16 : <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Signed 16 bit integer (data is encoded as a short in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-uint16" class="anchored"><a href="#val-uint16" class="anchor"></a><code><span><span class="keyword">val</span> uint16 : <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Unsigned 16 bit integer (data is encoded as a short in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int31" class="anchored"><a href="#val-int31" class="anchor"></a><code><span><span class="keyword">val</span> int31 : <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Signed 31 bit integer, which corresponds to type int on 32-bit OCaml systems (data is encoded as a 32 bit int in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int32" class="anchored"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span>int32 <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Signed 32 bit integer (data is encoded as a 32-bit int in binary and an integer in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int64" class="anchored"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span>int64 <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Signed 64 bit integer (data is encoded as a 64-bit int in binary and a decimal string in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ranged_int" class="anchored"><a href="#val-ranged_int" class="anchor"></a><code><span><span class="keyword">val</span> ranged_int : <span>int <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span>int <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Integer with bounds in a given range. Both bounds are inclusive.</p><dl><dt>raises Invalid_argument</dt><dd><p>if the bounds are beyond the interval <code>-2^30; 2^30-1</code>. These bounds are chosen to be compatible with all versions of OCaml.</p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-z" class="anchored"><a href="#val-z" class="anchor"></a><code><span><span class="keyword">val</span> z : <span><a href="../../../zarith/Z/index.html#type-t">Z.t</a> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Big number In JSON, data is encoded as a decimal string. In binary, data is encoded as a variable length sequence of bytes, with a running unary size bit: the most significant bit of each byte tells is this is the last byte in the sequence (0) or if there is more to read (1). The second most significant bit of the first byte is reserved for the sign (positive if zero). Binary_size and sign bits ignored, data is then the binary representation of the absolute value of the number in little-endian order.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-n" class="anchored"><a href="#val-n" class="anchor"></a><code><span><span class="keyword">val</span> n : <span><a href="../../../zarith/Z/index.html#type-t">Z.t</a> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Positive big number, see <code>z</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-float" class="anchored"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Encoding of floating point number (encoded as a floating point number in JSON and a double in binary).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ranged_float" class="anchored"><a href="#val-ranged_float" class="anchor"></a><code><span><span class="keyword">val</span> ranged_float : <span>float <span>&#45;&gt;</span></span> <span>float <span>&#45;&gt;</span></span> <span>float <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Float with bounds in a given range. Both bounds are inclusive</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Encoding of a boolean (data is encoded as a byte in binary and a boolean in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Encoding of a string</p><ul><li>encoded as a byte sequence in binary prefixed by the length of the string</li><li>encoded as a string in JSON.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-bytes" class="anchored"><a href="#val-bytes" class="anchor"></a><code><span><span class="keyword">val</span> bytes : <span><a href="../../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Encoding of arbitrary bytes (encoded via hex in JSON and directly as a sequence byte in binary).</p></div></div><h4 id="descriptor-combinators"><a href="#descriptor-combinators" class="anchor"></a>Descriptor combinators</h4><div class="odoc-spec"><div class="spec value" id="val-option" class="anchored"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Combinator to make an optional value (represented as a 1-byte tag followed by the data (or nothing) in binary and either the raw value or an empty object in JSON).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-result" class="anchored"><a href="#val-result" class="anchor"></a><code><span><span class="keyword">val</span> result : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Combinator to make a <a href="#val-result"><code>result</code></a> value (represented as a 1-byte tag followed by the data of either type in binary, and either unwrapped value in JSON (the caller must ensure that both encodings do not collide)).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-array" class="anchored"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span>?&#8288;max_length:int <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Array combinator.</p><ul><li>encoded as an array in JSON</li><li>encoded as the concatenation of all the element in binary prefixed its length in bytes</li></ul><p>If <code>max_length</code> is passed and the encoding of elements has fixed size, a <a href="#val-check_size"><code>check_size</code></a> is automatically added for earlier rejection.</p><dl><dt>raises Invalid_argument</dt><dd><p>if the inner encoding is variable.</p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span>?&#8288;max_length:int <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>List combinator.</p><ul><li>encoded as an array in JSON</li><li>encoded as the concatenation of all the element in binary prefixed its length in bytes</li></ul><p>If <code>max_length</code> is passed and the encoding of elements has fixed size, a <a href="#val-check_size"><code>check_size</code></a> is automatically added for earlier rejection.</p><dl><dt>raises Invalid_argument</dt><dd><p>if the inner encoding is also variable.</p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-conv" class="anchored"><a href="#val-conv" class="anchor"></a><code><span><span class="keyword">val</span> conv : <span><span>(<span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> <span>&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span></span> <span>?&#8288;schema:<a href="../../../json-data-encoding/Json_schema/index.html#type-schema">Json_schema.schema</a> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Provide a transformer from one encoding to a different one.</p><p>Used to simplify nested encodings or to change the generic tuples built by <a href="#val-obj1"><code>obj1</code></a>, <a href="#val-tup1"><code>tup1</code></a> and the like into proper records.</p><p>A schema may optionally be provided as documentation of the new encoding.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-assoc" class="anchored"><a href="#val-assoc" class="anchor"></a><code><span><span class="keyword">val</span> assoc : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Association list. An object in JSON, a list of pairs in binary.</p></div></div><h4 id="product-descriptors"><a href="#product-descriptors" class="anchor"></a>Product descriptors</h4><div class="odoc-spec"><div class="spec type" id="type-field" class="anchored"><a href="#type-field" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a field</span></span></code></div><div class="spec-doc"><p>An enriched encoding to represent a component in a structured type, augmenting the encoding with a name and whether it is a required or optional. Fields are used to encode OCaml tuples as objects in JSON, and as sequences in binary, using combinator <a href="#val-obj1"><code>obj1</code></a> and the like.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-req" class="anchored"><a href="#val-req" class="anchor"></a><code><span><span class="keyword">val</span> req : <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p>Required field.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-opt" class="anchored"><a href="#val-opt" class="anchor"></a><code><span><span class="keyword">val</span> opt : <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> option</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p>Optional field. Omitted entirely in JSON encoding if None. Omitted in binary if the only optional field in a <code>`Variable</code> encoding, otherwise a 1-byte prefix (`0` or `255`) tells if the field is present or not.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-varopt" class="anchored"><a href="#val-varopt" class="anchor"></a><code><span><span class="keyword">val</span> varopt : <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> option</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p>Optional field of variable length. Only one can be present in a given object.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dft" class="anchored"><a href="#val-dft" class="anchor"></a><code><span><span class="keyword">val</span> dft : <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-field">field</a></span></span></code></div><div class="spec-doc"><p>Required field with a default value. If the default value is passed, the field is omitted in JSON. The value is always serialized in binary.</p></div></div><h5 id="constructors-for-objects-with-n-fields"><a href="#constructors-for-objects-with-n-fields" class="anchor"></a>Constructors for objects with N fields</h5><p>These are serialized to binary by converting each internal object to binary and placing them in the order of the original object. These are serialized to JSON as a JSON object with the field names. An object might only contains one 'variable' field, typically the last one. If the encoding of more than one field are 'variable', the first ones should be wrapped with <code>dynamic_size</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if more than one field is a variable one.</p></dd></dl><div class="odoc-spec"><div class="spec value" id="val-obj1" class="anchored"><a href="#val-obj1" class="anchor"></a><code><span><span class="keyword">val</span> obj1 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj2" class="anchored"><a href="#val-obj2" class="anchor"></a><code><span><span class="keyword">val</span> obj2 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj3" class="anchored"><a href="#val-obj3" class="anchor"></a><code><span><span class="keyword">val</span> obj3 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj4" class="anchored"><a href="#val-obj4" class="anchor"></a><code><span><span class="keyword">val</span> obj4 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj5" class="anchored"><a href="#val-obj5" class="anchor"></a><code><span><span class="keyword">val</span> obj5 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj6" class="anchored"><a href="#val-obj6" class="anchor"></a><code><span><span class="keyword">val</span> obj6 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj7" class="anchored"><a href="#val-obj7" class="anchor"></a><code><span><span class="keyword">val</span> obj7 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj8" class="anchored"><a href="#val-obj8" class="anchor"></a><code><span><span class="keyword">val</span> obj8 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj9" class="anchored"><a href="#val-obj9" class="anchor"></a><code><span><span class="keyword">val</span> obj9 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f9</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-obj10" class="anchored"><a href="#val-obj10" class="anchor"></a><code><span><span class="keyword">val</span> obj10 : <span><span><span class="type-var">'f1</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f9</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f10</span> <a href="#type-field">field</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_objs" class="anchored"><a href="#val-merge_objs" class="anchor"></a><code><span><span class="keyword">val</span> merge_objs : <span><span><span class="type-var">'o1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'o2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'o1</span> * <span class="type-var">'o2</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Create a larger object from the encodings of two smaller ones.</p><dl><dt>raises Invalid_argument</dt><dd><p>if both arguments are not objects or if both tuples contains a variable field..</p></dd></dl></div></div><h5 id="constructors-for-tuples-with-n-fields"><a href="#constructors-for-tuples-with-n-fields" class="anchor"></a>Constructors for tuples with N fields</h5><p>These are serialized to binary by converting each internal object to binary and placing them in the order of the original object. These are serialized to JSON as JSON arrays/lists. Like objects, a tuple might only contains one 'variable' field, typically the last one. If the encoding of more than one field are 'variable', the first ones should be wrapped with <code>dynamic_size</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if more than one field is a variable one.</p></dd></dl><div class="odoc-spec"><div class="spec value" id="val-tup1" class="anchored"><a href="#val-tup1" class="anchor"></a><code><span><span class="keyword">val</span> tup1 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup2" class="anchored"><a href="#val-tup2" class="anchor"></a><code><span><span class="keyword">val</span> tup2 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup3" class="anchored"><a href="#val-tup3" class="anchor"></a><code><span><span class="keyword">val</span> tup3 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup4" class="anchored"><a href="#val-tup4" class="anchor"></a><code><span><span class="keyword">val</span> tup4 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup5" class="anchored"><a href="#val-tup5" class="anchor"></a><code><span><span class="keyword">val</span> tup5 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup6" class="anchored"><a href="#val-tup6" class="anchor"></a><code><span><span class="keyword">val</span> tup6 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup7" class="anchored"><a href="#val-tup7" class="anchor"></a><code><span><span class="keyword">val</span> tup7 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup8" class="anchored"><a href="#val-tup8" class="anchor"></a><code><span><span class="keyword">val</span> tup8 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup9" class="anchored"><a href="#val-tup9" class="anchor"></a><code><span><span class="keyword">val</span> tup9 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f9</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tup10" class="anchored"><a href="#val-tup10" class="anchor"></a><code><span><span class="keyword">val</span> tup10 : <span><span><span class="type-var">'f1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f3</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f4</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f5</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f6</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f7</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f8</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f9</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'f10</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-merge_tups" class="anchored"><a href="#val-merge_tups" class="anchor"></a><code><span><span class="keyword">val</span> merge_tups : <span><span><span class="type-var">'a1</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a2</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span class="type-var">'a1</span> * <span class="type-var">'a2</span>)</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Create a large tuple encoding from two smaller ones.</p><dl><dt>raises Invalid_argument</dt><dd><p>if both values are not tuples or if both tuples contains a variable field.</p></dd></dl></div></div><h4 id="sum-descriptors"><a href="#sum-descriptors" class="anchor"></a>Sum descriptors</h4><div class="odoc-spec"><div class="spec type" id="type-case" class="anchored"><a href="#type-case" class="anchor"></a><code><span><span class="keyword">type</span> <span>'t case</span></span></code></div><div class="spec-doc"><p>A partial encoding to represent a case in a variant type. Hides the (existentially bound) type of the parameter to the specific case, providing its encoder, and converter functions to and from the union type.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-case_tag" class="anchored"><a href="#type-case_tag" class="anchor"></a><code><span><span class="keyword">type</span> case_tag</span><span> = </span></code><table><tr id="type-case_tag.Tag" class="anchored"><td class="def variant constructor"><a href="#type-case_tag.Tag" class="anchor"></a><code><span>| </span><span><span class="constructor">Tag</span> <span class="keyword">of</span> int</span></code></td></tr><tr id="type-case_tag.Json_only" class="anchored"><td class="def variant constructor"><a href="#type-case_tag.Json_only" class="anchor"></a><code><span>| </span><span><span class="constructor">Json_only</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-matching_function" class="anchored"><a href="#type-matching_function" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a matching_function</span></span><span> = <span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <a href="#type-match_result">match_result</a></span></code></div><div class="spec-doc"><p>A sum descriptor can be optimized by providing a specific <code>matching_function</code> which efficiently determines in which case some value of type <code>'a</code> falls.</p><p>Note that in general you should use a total function (i.e., one defined over the whole of the <code>'a</code> type) for the <code>matching_function</code>. However, in the case where you have a good reason to use a partial function, you should raise <code>No_case_matched</code> in the dead branches. Reasons why you may want to do so include:</p><ul><li><code>'a</code> is an open variant and you will complete the matching function later, and</li><li>there is a code invariant that guarantees that <code>'a</code> is not fully inhabited.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-match_result" class="anchored"><a href="#type-match_result" class="anchor"></a><code><span><span class="keyword">and</span> match_result</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-matched" class="anchored"><a href="#val-matched" class="anchor"></a><code><span><span class="keyword">val</span> matched : <span>?&#8288;tag_size:<span>[ `Uint8 <span>| `Uint16</span> ]</span> <span>&#45;&gt;</span></span> <span>int <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <a href="#type-match_result">match_result</a></span></code></div><div class="spec-doc"><p><code>matched t e u</code> represents the fact that a value is tagged with <code>t</code> and carries the payload <code>u</code> which can be encoded with <code>e</code>.</p><p>The optional argument <code>tag_size</code> must match the one passed to the <a href="#val-matching"><code>matching</code></a> function <code>matched</code> is called inside of.</p><p>An example is given in the documentation of <a href="#val-matching"><code>matching</code></a>.</p><dl><dt>raises [Invalid_argument]</dt><dd><p>if <code>t &lt; 0</code></p></dd></dl><dl><dt>raises [Invalid_argument]</dt><dd><p>if <code>t</code> does not fit in <code>tag_size</code></p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-case" class="anchored"><a href="#val-case" class="anchor"></a><code><span><span class="keyword">val</span> case : <span>title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span>
<span><a href="#type-case_tag">case_tag</a> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'t</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span>&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span class="type-var">'t</span>)</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-case">case</a></span></span></code></div><div class="spec-doc"><p>Encodes a variant constructor. Takes the encoding for the specific parameters, a recognizer function that will extract the parameters in case the expected case of the variant is being serialized, and a constructor function for deserialization.</p><p>The tag must be less than the tag size of the union in which you use the case. An optional tag gives a name to a case and should be used to maintain compatibility.</p><p>An optional name for the case can be provided, which is used in the binary documentation.</p><dl><dt>raises [Invalid_argument]</dt><dd><p>if <code>case_tag</code> is <code>Tag t</code> with <code>t &lt; 0</code></p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-matching" class="anchored"><a href="#val-matching" class="anchor"></a><code><span><span class="keyword">val</span> matching : <span>?&#8288;tag_size:<span>[ `Uint8 <span>| `Uint16</span> ]</span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-matching_function">matching_function</a></span> <span>&#45;&gt;</span></span> <span><span><span><span class="type-var">'t</span> <a href="#type-case">case</a></span> list</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Create a single encoding from a series of cases.</p><p>In JSON, all cases are tried one after the other using the <code>case list</code>. The caller is responsible for avoiding collisions. If there are collisions (i.e., if multiple cases produce the same JSON output) then the encoding and decoding processes might not be inverse of each other. In other words, <code>destruct e (construct e v)</code> may not be equal to <code>v</code>.</p><p>In binary, a prefix tag is added to discriminate quickly between cases. The default is <code>`Uint8</code> and you must use a <code>`Uint16</code> if you are going to have more than 256 cases.</p><p>The matching function is used during binary encoding of a value <code>v</code> to efficiently determine which of the cases corresponds to <code>v</code>. The case list is used during decoding to reconstruct a value based on the encoded tag. (Decoding is optimised internally: tag look-up has a constant cost.)</p><p>The caller is responsible for ensuring that the <code>matching_function</code> and the <code>case list</code> describe the same encoding. If they describe different encodings, then the decoding and encoding processes will not be inverses of each others. In other words, <code>of_bytes e (to_bytes e v)</code> will not be equal to <code>v</code>.</p><p>If you do not wish to be responsible for this, you can use the unoptimised <a href="#val-union"><code>union</code></a> that uses a <code>case list</code> only (see below). Beware that in <a href="#val-union"><code>union</code></a> the complexity of the encoding is linear in the number of cases.</p><p>Following: a basic example use. Note that the <code>matching_function</code> uses the same tags, payload conversions, and payload encoding as the <code>case list</code>.</p><pre><code>type t = A of string | B of int * int | C
let encoding_t =
  (* Tags and payload encodings for each constructors *)
  let a_tag = 0 and a_encoding = string in
  let b_tag = 1 and b_encoding = obj2 (req &quot;x&quot; int) (req &quot;y&quot; int) in
  let c_tag = 2 and c_encoding = unit in
  matching
    (* optimised encoding function *)
    (function
       | A s -&gt; matched a_tag a_encoding s
       | B (x, y) -&gt; matched b_tag b_encoding (x, y)
       | C -&gt; matched c_tag c_encoding ())
    (* decoding case list *)
    [
       case ~title:&quot;A&quot;
         (Tag a_tag)
         a_encoding
         (function A s -&gt; Some s | _ -&gt; None) (fun s -&gt; A s);
       case ~title:&quot;B&quot;
         (Tag b_tag)
         b_encoding
         (function B (x, y) -&gt; Some (x, y) | _ -&gt; None) (fun (x, y) -&gt; B (x, y));
       case ~title:&quot;C&quot;
         (Tag c_tag)
         c_encoding
         (function C -&gt; Some () | _ -&gt; None) (fun () -&gt; C);
    ]</code></pre><dl><dt>raises [Invalid_argument]</dt><dd><p>if it is given an empty <code>case list</code></p></dd></dl><dl><dt>raises [Invalid_argument]</dt><dd><p>if there are more than one <code>case</code> with the same <code>tag</code> in the <code>case list</code></p></dd></dl><dl><dt>raises [Invalid_argument]</dt><dd><p>if there are more cases in the <code>case list</code> than can fit in the <code>tag_size</code></p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-union" class="anchored"><a href="#val-union" class="anchor"></a><code><span><span class="keyword">val</span> union : <span>?&#8288;tag_size:<span>[ `Uint8 <span>| `Uint16</span> ]</span> <span>&#45;&gt;</span></span> <span><span><span><span class="type-var">'t</span> <a href="#type-case">case</a></span> list</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Same as matching except that the matching function is a linear traversal of the cases.</p><dl><dt>raises [Invalid_argument]</dt><dd><p>if it is given an empty <code>case list</code></p></dd></dl><dl><dt>raises [Invalid_argument]</dt><dd><p>if there are more than one <code>case</code> with the same <code>tag</code> in the <code>case list</code></p></dd></dl><dl><dt>raises [Invalid_argument]</dt><dd><p>if there are more cases in the <code>case list</code> than can fit in the <code>tag_size</code></p></dd></dl></div></div><h4 id="predicates-over-descriptors"><a href="#predicates-over-descriptors" class="anchor"></a>Predicates over descriptors</h4><div class="odoc-spec"><div class="spec value" id="val-is_obj" class="anchored"><a href="#val-is_obj" class="anchor"></a><code><span><span class="keyword">val</span> is_obj : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is the given encoding serialized as a JSON object?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_tup" class="anchored"><a href="#val-is_tup" class="anchor"></a><code><span><span class="keyword">val</span> is_tup : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Does the given encoding encode a tuple?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-classify" class="anchored"><a href="#val-classify" class="anchor"></a><code><span><span class="keyword">val</span> classify : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span>[ <span>`Fixed of int</span> <span>| `Dynamic</span> <span>| `Variable</span> ]</span></span></code></div><div class="spec-doc"><p>Classify the binary serialization of an encoding as explained in the preamble.</p></div></div><h4 id="specialized-descriptors"><a href="#specialized-descriptors" class="anchor"></a>Specialized descriptors</h4><div class="odoc-spec"><div class="spec value" id="val-string_enum" class="anchored"><a href="#val-string_enum" class="anchor"></a><code><span><span class="keyword">val</span> string_enum : <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Encode enumeration via association list</p><ul><li>represented as a string in JSON and</li><li>represented as an integer representing the element's position in the list in binary. The integer size depends on the list size.</li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Fixed" class="anchored"><a href="#module-Fixed" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Fixed/index.html">Fixed</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Create encodings that produce data of a fixed length when binary encoded. See the preamble for an explanation.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Variable" class="anchored"><a href="#module-Variable" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Variable/index.html">Variable</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Create encodings that produce data of a variable length when binary encoded. See the preamble for an explanation.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Bounded" class="anchored"><a href="#module-Bounded" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Bounded/index.html">Bounded</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-dynamic_size" class="anchored"><a href="#val-dynamic_size" class="anchor"></a><code><span><span class="keyword">val</span> dynamic_size : <span>?&#8288;kind:<span>[ `Uint30 <span>| `Uint16</span> <span>| `Uint8</span> ]</span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Mark an encoding as being of dynamic size. Forces the size to be stored alongside content when needed. Typically used to combine two variable encodings in a same objects or tuple, or to use a variable encoding in an array or a list.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_size" class="anchored"><a href="#val-check_size" class="anchor"></a><code><span><span class="keyword">val</span> check_size : <span>int <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p><code>check_size size encoding</code> ensures that the binary encoding of a value will not be allowed to exceed <code>size</code> bytes. The reader and the writer fails otherwise. This function do not modify the JSON encoding.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-delayed" class="anchored"><a href="#val-delayed" class="anchor"></a><code><span><span class="keyword">val</span> delayed : <span><span>(<span>unit <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span>)</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Recompute the encoding definition each time it is used. Useful for dynamically updating the encoding of values of an extensible type via a global reference (e.g., exceptions).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-splitted" class="anchored"><a href="#val-splitted" class="anchor"></a><code><span><span class="keyword">val</span> splitted : <span>json:<span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span>binary:<span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Define different encodings for JSON and binary serialization.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-mu" class="anchored"><a href="#val-mu" class="anchor"></a><code><span><span class="keyword">val</span> mu : <span>string <span>&#45;&gt;</span></span> <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span>)</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Combinator for recursive encodings.</p><p>Notice that the function passed to <code>mu</code> must be pure. Otherwise, the behavior is unspecified.</p><p>A stateful recursive encoding can still be put under a <code>delayed</code> combinator to make sure that a new encoding is generated each time it is used. Caching the encoding generation when the state has not changed is then the responsability of the client.</p></div></div><h4 id="documenting-descriptors"><a href="#documenting-descriptors" class="anchor"></a>Documenting descriptors</h4><div class="odoc-spec"><div class="spec value" id="val-def" class="anchored"><a href="#val-def" class="anchor"></a><code><span><span class="keyword">val</span> def : <span>string <span>&#45;&gt;</span></span> <span>?&#8288;title:string <span>&#45;&gt;</span></span> <span>?&#8288;description:string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Give a name to an encoding and optionally add documentation to an encoding.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-lazy_t" class="anchored"><a href="#type-lazy_t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a lazy_t</span></span></code></div><div class="spec-doc"><p>See <a href="#val-lazy_encoding"><code>lazy_encoding</code></a> below.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lazy_encoding" class="anchored"><a href="#val-lazy_encoding" class="anchor"></a><code><span><span class="keyword">val</span> lazy_encoding : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-lazy_t">lazy_t</a></span> <a href="#type-encoding">encoding</a></span></span></code></div><div class="spec-doc"><p>Combinator to have a part of the binary encoding lazily deserialized. This is transparent on the JSON side.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-force_decode" class="anchored"><a href="#val-force_decode" class="anchor"></a><code><span><span class="keyword">val</span> force_decode : <span><span><span class="type-var">'a</span> <a href="#type-lazy_t">lazy_t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Force the decoding (memoized for later calls), and return the value if successful.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-force_bytes" class="anchored"><a href="#val-force_bytes" class="anchor"></a><code><span><span class="keyword">val</span> force_bytes : <span><span><span class="type-var">'a</span> <a href="#type-lazy_t">lazy_t</a></span> <span>&#45;&gt;</span></span> <a href="../../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a></span></code></div><div class="spec-doc"><p>Obtain the bytes without actually deserializing. Will serialize and memoize the result if the value is not the result of a lazy deserialization.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make_lazy" class="anchored"><a href="#val-make_lazy" class="anchor"></a><code><span><span class="keyword">val</span> make_lazy : <span><span><span class="type-var">'a</span> <a href="#type-encoding">encoding</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-lazy_t">lazy_t</a></span></span></code></div><div class="spec-doc"><p>Make a lazy value from an immediate one.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-apply_lazy" class="anchored"><a href="#val-apply_lazy" class="anchor"></a><code><span><span class="keyword">val</span> apply_lazy : <span>fun_value:<span>(<span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span></span> <span>fun_bytes:<span>(<span><a href="../../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span></span>
<span>fun_combine:<span>(<span><span class="type-var">'b</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-lazy_t">lazy_t</a></span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p>Apply on structure of lazy value, and combine results</p></div></div><p>Create a <a href="../index.html#type-t"><code>Data_encoding.t</code></a> value which records knowledge of older versions of a given encoding as long as one can &quot;upgrade&quot; from an older version to the next (if upgrade is impossible one should consider that the encoding is completely different).</p><p>See the module <code>Documented_example</code> in <code>&quot;./test/versioned.ml&quot;</code> for a tutorial.</p></div></body></html>