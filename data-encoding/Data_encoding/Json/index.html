<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Json (data-encoding.Data_encoding.Json)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">data-encoding</a> &#x00BB; <a href="../index.html">Data_encoding</a> &#x00BB; Json</nav><header class="odoc-preamble"><h1>Module <code><span>Data_encoding.Json</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-json" class="anchored"><a href="#type-json" class="anchor"></a><code><span><span class="keyword">type</span> json</span><span> = </span><span>[ </span></code><table><tr id="type-json.O" class="anchored"><td class="def constructor"><a href="#type-json.O" class="anchor"></a><code><span>| </span></code><code><span>`O <span class="keyword">of</span> <span><span>(string * <a href="#type-json">json</a>)</span> list</span></span></code></td></tr><tr id="type-json.Bool" class="anchored"><td class="def constructor"><a href="#type-json.Bool" class="anchor"></a><code><span>| </span></code><code><span>`Bool <span class="keyword">of</span> bool</span></code></td></tr><tr id="type-json.Float" class="anchored"><td class="def constructor"><a href="#type-json.Float" class="anchor"></a><code><span>| </span></code><code><span>`Float <span class="keyword">of</span> float</span></code></td></tr><tr id="type-json.A" class="anchored"><td class="def constructor"><a href="#type-json.A" class="anchor"></a><code><span>| </span></code><code><span>`A <span class="keyword">of</span> <span><a href="#type-json">json</a> list</span></span></code></td></tr><tr id="type-json.Null" class="anchored"><td class="def constructor"><a href="#type-json.Null" class="anchor"></a><code><span>| </span></code><code><span>`Null</span></code></td></tr><tr id="type-json.String" class="anchored"><td class="def constructor"><a href="#type-json.String" class="anchor"></a><code><span>| </span></code><code><span>`String <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>In memory JSON data, compatible with <code>Ezjsonm</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <a href="#type-json">json</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-schema" class="anchored"><a href="#type-schema" class="anchor"></a><code><span><span class="keyword">type</span> schema</span><span> = <a href="../../../json-data-encoding/Json_schema/index.html#type-schema">Json_schema.schema</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-encoding" class="anchored"><a href="#val-encoding" class="anchor"></a><code><span><span class="keyword">val</span> encoding : <span><a href="#type-json">json</a> <a href="../Encoding/index.html#type-t">Encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encodes raw JSON data (BSON is used for binary).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-schema_encoding" class="anchored"><a href="#val-schema_encoding" class="anchor"></a><code><span><span class="keyword">val</span> schema_encoding : <span><a href="#type-schema">schema</a> <a href="../Encoding/index.html#type-t">Encoding.t</a></span></span></code></div><div class="spec-doc"><p>Encodes a JSON schema (BSON encoded for binary).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-convert" class="anchored"><a href="#val-convert" class="anchor"></a><code><span><span class="keyword">val</span> convert : <span><span><span class="type-var">'a</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../../../json-data-encoding/Json_encoding/index.html#type-encoding">Json_encoding.encoding</a></span></span></code></div><div class="spec-doc"><p>Create a <a href="../../../json-data-encoding/Json_encoding/index.html#type-encoding"><code>Json_encoding.encoding</code></a> from an <a href="#val-encoding"><code>encoding</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-schema" class="anchored"><a href="#val-schema" class="anchor"></a><code><span><span class="keyword">val</span> schema : <span>?&#8288;definitions_path:string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span>&#45;&gt;</span></span> <a href="#type-schema">schema</a></span></code></div><div class="spec-doc"><p>Generate a schema from an <a href="#val-encoding"><code>encoding</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-construct" class="anchored"><a href="#val-construct" class="anchor"></a><code><span><span class="keyword">val</span> construct : <span><span><span class="type-var">'t</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span>&#45;&gt;</span></span> <a href="#type-json">json</a></span></code></div><div class="spec-doc"><p>Construct a JSON object from an encoding.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-jsonm_lexeme" class="anchored"><a href="#type-jsonm_lexeme" class="anchor"></a><code><span><span class="keyword">type</span> jsonm_lexeme</span><span> = </span><span>[ </span></code><table><tr id="type-jsonm_lexeme.Null" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Null" class="anchor"></a><code><span>| </span></code><code><span>`Null</span></code></td></tr><tr id="type-jsonm_lexeme.Bool" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Bool" class="anchor"></a><code><span>| </span></code><code><span>`Bool <span class="keyword">of</span> bool</span></code></td></tr><tr id="type-jsonm_lexeme.String" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.String" class="anchor"></a><code><span>| </span></code><code><span>`String <span class="keyword">of</span> string</span></code></td></tr><tr id="type-jsonm_lexeme.Float" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Float" class="anchor"></a><code><span>| </span></code><code><span>`Float <span class="keyword">of</span> float</span></code></td></tr><tr id="type-jsonm_lexeme.Name" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Name" class="anchor"></a><code><span>| </span></code><code><span>`Name <span class="keyword">of</span> string</span></code></td></tr><tr id="type-jsonm_lexeme.As" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.As" class="anchor"></a><code><span>| </span></code><code><span>`As</span></code></td></tr><tr id="type-jsonm_lexeme.Ae" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Ae" class="anchor"></a><code><span>| </span></code><code><span>`Ae</span></code></td></tr><tr id="type-jsonm_lexeme.Os" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Os" class="anchor"></a><code><span>| </span></code><code><span>`Os</span></code></td></tr><tr id="type-jsonm_lexeme.Oe" class="anchored"><td class="def constructor"><a href="#type-jsonm_lexeme.Oe" class="anchor"></a><code><span>| </span></code><code><span>`Oe</span></code></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-construct_seq" class="anchored"><a href="#val-construct_seq" class="anchor"></a><code><span><span class="keyword">val</span> construct_seq : <span><span><span class="type-var">'t</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span>&#45;&gt;</span></span> <span><a href="#type-jsonm_lexeme">jsonm_lexeme</a> <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span></span></code></div><div class="spec-doc"><p><code>construct_seq enc t</code> is a representation of <code>t</code> as a sequence of json lexeme (<code>jsonm_lexeme Seq.t</code>). This sequence is lazy: lexemes are computed on-demand.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_seq_of_jsonm_lexeme_seq" class="anchored"><a href="#val-string_seq_of_jsonm_lexeme_seq" class="anchor"></a><code><span><span class="keyword">val</span> string_seq_of_jsonm_lexeme_seq : <span>newline:bool <span>&#45;&gt;</span></span> <span>chunk_size_hint:int <span>&#45;&gt;</span></span>
<span><span><a href="#type-jsonm_lexeme">jsonm_lexeme</a> <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span> <span>&#45;&gt;</span></span> <span>string <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span></span></code></div><div class="spec-doc"><p><code>string_seq_of_jsonm_lexeme_seq ~newline ~chunk_size_hint s</code> is a sequence of strings, the concatenation of which is a valid textual representation of the json value represented by <code>s</code>. Each string chunk is roughly <code>chunk_size_hint</code> long (except the last one that may be shorter).</p><p>With the <code>newline</code> parameter set to <code>true</code>, a single newline character is appended to the textual representation.</p><p>Forcing one element of the resulting string sequence forces multiple elements of the underlying lexeme sequence. Once enough lexemes have been forced that roughly <code>chunk_size_hint</code> characters are needed to reprensent them, the representation is returned and the rest of the sequence is held lazily.</p><p>Note that most chunks split at a lexeme boundary. This may not be true for string literals or float literals, the representation of which may be spread across multiple chunks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-small_string_seq_of_jsonm_lexeme_seq" class="anchored"><a href="#val-small_string_seq_of_jsonm_lexeme_seq" class="anchor"></a><code><span><span class="keyword">val</span> small_string_seq_of_jsonm_lexeme_seq : <span>newline:bool <span>&#45;&gt;</span></span> <span><span><a href="#type-jsonm_lexeme">jsonm_lexeme</a> <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span> <span>&#45;&gt;</span></span> <span>string <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-blit_instructions_seq_of_jsonm_lexeme_seq" class="anchored"><a href="#val-blit_instructions_seq_of_jsonm_lexeme_seq" class="anchor"></a><code><span><span class="keyword">val</span> blit_instructions_seq_of_jsonm_lexeme_seq : <span>newline:bool <span>&#45;&gt;</span></span> <span>buffer:bytes <span>&#45;&gt;</span></span>
<span><span><a href="#type-jsonm_lexeme">jsonm_lexeme</a> <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span> <span>&#45;&gt;</span></span> <span><span>(<a href="../../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> * int * int)</span> <a href="../../../ocaml/Stdlib/Seq/index.html#type-t">Stdlib.Seq.t</a></span></span></code></div><div class="spec-doc"><p><code>blit_instructions_seq_of_jsonm_lexeme_seq ~newline ~buffer json</code> is a sequence of <code>(buff, offset, length)</code> such that the concatenation of the sub-strings thus designated represents the json value in text form.</p><dl><dt>raises [Invalid_argument</dt><dd><p>_] if <code>Bytes.length buffer</code> is less than 32.</p><p>The intended use is to blit each of the substring onto whatever output the consumer decides. In most cases, the Sequence's <code>buff</code> is physically equal to <code>buffer</code>. This is not always true and one cannot rely on that fact. E.g., when the json includes a long string literal, the function might instruct the consumer to blit from that literal directly.</p><p>This function performs few allocations, especially of fresh strings.</p><p>Note that once the next element of the sequence is forced, the blit instructions become invalid: the content of <code>buff</code> may have been rewritten by the side effect of forcing the next element.</p></dd></dl></div></div><div class="odoc-spec"><div class="spec value" id="val-destruct" class="anchored"><a href="#val-destruct" class="anchor"></a><code><span><span class="keyword">val</span> destruct : <span><span><span class="type-var">'t</span> <a href="../Encoding/index.html#type-t">Encoding.t</a></span> <span>&#45;&gt;</span></span> <span><a href="#type-json">json</a> <span>&#45;&gt;</span></span> <span class="type-var">'t</span></span></code></div><div class="spec-doc"><p>Destruct a JSON object into a value. Fail with an exception if the JSON object and encoding do not match..</p></div></div><p>JSON Error.</p><div class="odoc-spec"><div class="spec type" id="type-path" class="anchored"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">type</span> path</span><span> = <span><a href="#type-path_item">path_item</a> list</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-path_item" class="anchored"><a href="#type-path_item" class="anchor"></a><code><span><span class="keyword">and</span> path_item</span><span> = </span><span>[ </span></code><table><tr id="type-path_item.Field" class="anchored"><td class="def constructor"><a href="#type-path_item.Field" class="anchor"></a><code><span>| </span></code><code><span>`Field <span class="keyword">of</span> string</span></code></td><td class="doc"><p>A field in an object.</p></td></tr><tr id="type-path_item.Index" class="anchored"><td class="def constructor"><a href="#type-path_item.Index" class="anchor"></a><code><span>| </span></code><code><span>`Index <span class="keyword">of</span> int</span></code></td><td class="doc"><p>An index in an array.</p></td></tr><tr id="type-path_item.Star" class="anchored"><td class="def constructor"><a href="#type-path_item.Star" class="anchor"></a><code><span>| </span></code><code><span>`Star</span></code></td><td class="doc"><p>Any / every field or index.</p></td></tr><tr id="type-path_item.Next" class="anchored"><td class="def constructor"><a href="#type-path_item.Next" class="anchor"></a><code><span>| </span></code><code><span>`Next</span></code></td><td class="doc"><p>The next element after an array.</p></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p>A set of accessors that point to a location in a JSON object.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Cannot_destruct" class="anchored"><a href="#exception-Cannot_destruct" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Cannot_destruct</span> <span class="keyword">of</span> <a href="#type-path">path</a> * exn</span></code></div><div class="spec-doc"><p>Exception raised by destructors, with the location in the original JSON structure and the specific error.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Unexpected" class="anchored"><a href="#exception-Unexpected" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unexpected</span> <span class="keyword">of</span> string * string</span></code></div><div class="spec-doc"><p>Unexpected kind of data encountered, with the expectation.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-No_case_matched" class="anchored"><a href="#exception-No_case_matched" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">No_case_matched</span> <span class="keyword">of</span> <span>exn list</span></span></code></div><div class="spec-doc"><p>Some <a href="../index.html#val-union"><code>union</code></a> couldn't be destructed, with the reasons for each <a href="../index.html#val-case"><code>case</code></a>.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Bad_array_size" class="anchored"><a href="#exception-Bad_array_size" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Bad_array_size</span> <span class="keyword">of</span> int * int</span></code></div><div class="spec-doc"><p>Array of unexpected size encountered, with the expectation.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Missing_field" class="anchored"><a href="#exception-Missing_field" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Missing_field</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Missing field in an object.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Unexpected_field" class="anchored"><a href="#exception-Unexpected_field" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unexpected_field</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Supernumerary field in an object.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-print_error" class="anchored"><a href="#val-print_error" class="anchor"></a><code><span><span class="keyword">val</span> print_error : <span>?&#8288;print_unknown:<span>(<span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span>exn <span>&#45;&gt;</span></span> unit)</span> <span>&#45;&gt;</span></span> <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span>exn <span>&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-cannot_destruct" class="anchored"><a href="#val-cannot_destruct" class="anchor"></a><code><span><span class="keyword">val</span> cannot_destruct : <span><span><span>(<span class="type-var">'a</span>, <a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a>, unit, <span class="type-var">'b</span>)</span> <a href="../../../ocaml/Stdlib/index.html#type-format4">Stdlib.format4</a></span> <span>&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Helpers for writing encoders.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-wrap_error" class="anchored"><a href="#val-wrap_error" class="anchor"></a><code><span><span class="keyword">val</span> wrap_error : <span><span>(<span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span>&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-from_string" class="anchored"><a href="#val-from_string" class="anchor"></a><code><span><span class="keyword">val</span> from_string : <span>string <span>&#45;&gt;</span></span> <span><span>(<a href="#type-json">json</a>, string)</span> <a href="../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></span></code></div><div class="spec-doc"><p>Read a JSON document from a string.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span>?&#8288;newline:bool <span>&#45;&gt;</span></span> <span>?&#8288;minify:bool <span>&#45;&gt;</span></span> <span><a href="#type-json">json</a> <span>&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Write a JSON document to a string. This goes via an intermediate buffer and so may be slow on large documents.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span><a href="#type-json">json</a> <span>&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>