<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Runtime (bisect_ppx.Bisect.Runtime)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">bisect_ppx</a> &#x00BB; <a href="../index.html">Bisect</a> &#x00BB; Runtime</nav><header class="odoc-preamble"><h1>Module <code><span>Bisect.Runtime</span></code></h1><p>This module provides runtime support for Bisect. Instrumented programs should hence be linked with this module.</p><p>Each instrumented file creates an array of counters, one for each point in that file. It then registers the array with this runtime module. Upon program exit (using <code>at_exit</code>), this module dumps the accumulated counts from all the arrays into an output file.</p><p>The default base name for the output file is <code>bisect</code> in the current directory, but another base name can be specified using the <code>BISECT_FILE</code> environment variable. The actual file name is the first non-existing <code>&lt;base&gt;&lt;n&gt;.coverage</code> file where <code>base</code> is the base name and <code>n</code> a natural number value padded with zeroes to 4 digits (i.e. &quot;0001&quot;, &quot;0002&quot;, and so on).</p><p>Another environment variable can be used to customize the behaviour of Bisect: <code>BISECT_SILENT</code>. If this variable is set to <code>YES</code> or <code>ON</code> (ignoring case), then Bisect will not output any message. Otherwise, Bisect will output a message in two situations:</p><ul><li>when the output file cannot be created at program termination;</li><li>when the data cannot be written at program termination. If <code>BISECT_SILENT</code> is set to <code>ERR</code> (ignoring case), these error messages are routed to <code>stderr</code>, otherwise <code>BISECT_SILENT</code> is used to determine a filename for this output. The default value is <code>bisect.log</code>.</li></ul><p>Because instrumented modules refer to <code>Bisect</code>, one is advised to link this module as one of the first ones of the program.</p><p>Since the counts output file and log file are, by default, relative to the current working directory, an instrumented process should be careful about changing its working directory, or else <code>BISECT_FILE</code> and <code>BISECT_SILENT</code> should be specified with absolute paths.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-register_file" class="anchored"><a href="#val-register_file" class="anchor"></a><code><span><span class="keyword">val</span> register_file : <span>bisect_file:<span>string option</span> <span>&#45;&gt;</span></span> <span>bisect_silent:<span>string option</span> <span>&#45;&gt;</span></span>
<span>string <span>&#45;&gt;</span></span> <span>point_count:int <span>&#45;&gt;</span></span> <span>point_definitions:string <span>&#45;&gt;</span></span> <span>[ <span>`Staged of <span>int <span>&#45;&gt;</span></span> unit</span> ]</span></span></code></div><div class="spec-doc"><p><code>register_file ~bisect_file ~bisect_silent file ~point_count
    ~point_definitions</code> indicates that the file <code>file</code> is part of the application that has been instrumented. <code>point_definitions</code> is a serialized <code>Common.point_definition list</code> giving the locations of all points in the file. The returned callback is used to increment visitation counts. <code>bisect_file</code> (resp. <code>bisect_silent</code>) is a default value for the environment variable <code>BISECT_FILE</code> (resp. <code>BISECT_SILENT</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_coverage_data" class="anchored"><a href="#val-get_coverage_data" class="anchor"></a><code><span><span class="keyword">val</span> get_coverage_data : <span>unit <span>&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Returns the binary coverage data accumulated by the program so far. This should eventually be written to a file, to be processed by <code>bisect-ppx-report</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_coverage_data" class="anchored"><a href="#val-write_coverage_data" class="anchor"></a><code><span><span class="keyword">val</span> write_coverage_data : <span>unit <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>On Node.js, writes the same coverage data that is returned by <a href="#val-get_coverage_data"><code>get_coverage_data</code></a> to a <code>.coverage</code> file with a randomized name in the current directory.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-dump_counters_exn" class="anchored"><a href="#val-dump_counters_exn" class="anchor"></a><code><span><span class="keyword">val</span> dump_counters_exn : <span><a href="../../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>dump_counters_exn channel</code> dumps the runtime coverage counters to the specified <code>channel</code>.</p><p>An exception is raised if writing is not successful</p></div></div><div class="odoc-spec"><div class="spec value" id="val-reset_counters" class="anchored"><a href="#val-reset_counters" class="anchor"></a><code><span><span class="keyword">val</span> reset_counters : <span>unit <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>reset_counters ()</code> will reset the runtime coverage counters.</p></div></div></div></body></html>