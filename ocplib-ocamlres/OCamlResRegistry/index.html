<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OCamlResRegistry (ocplib-ocamlres.OCamlResRegistry)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">ocplib-ocamlres</a> &#x00BB; OCamlResRegistry</nav><header class="odoc-preamble"><h1>Module <code><span>OCamlResRegistry</span></code></h1><p>Registration of (sub)formats for use from the command line</p></header><nav class="odoc-toc"><ul><li><a href="#formats-registry">Formats registry</a></li><li><a href="#subformats-registry">SubFormats registry</a></li><li><a href="#predefined-subformats">Predefined Subformats</a></li><li><a href="#predefined-formats">Predefined Formats</a></li></ul></nav><div class="odoc-content"><p>This file implements the interface between OCaml defintions of Format and SubFormat module instances and the command line interface of ocp-ocamlres.</p><p>Basically, it consists in pre-instanciating the formats:</p><ul><li>with string valued resource trees as input where the strings are the raw contents as extracted from the files</li><li>with a proxy subformat, performing a dynamic dispatch of the subformat depending on file extensions</li></ul><p>To associate the extensions with the subformats, it maintains an assiciative table to link the command line name of the subformat to the OCaml implementation (as a packed module).</p><p>Same is done with the main format names, and both tables can be extended to the tool can be extended from outside this module (by recompiling it with / dynlinking a module performing a (sub)format registration at toplevel)</p><h3 id="formats-registry"><a href="#formats-registry" class="anchor"></a>Formats registry</h3><div class="odoc-spec"><div class="spec module-type" id="module-type-Format" class="anchored"><a href="#module-type-Format" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-Format/index.html">Format</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The type of format plug-ins. Differs from <a href="../OCamlResFormats/module-type-Format/index.html"><code>OCamlResFormats.Format</code></a> since it is dedicated to be used by the command line tool. For this, the parameters are provided not as a data type but as a list of command line args that can mutate global references, which can then be read from the output function. This is because parameters come from the user, not the programmer. Also, the tool is dedicated to use with the filesystem, so the type of data is fixed to strings representing the raw encoding of data.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register_format" class="anchored"><a href="#val-register_format" class="anchor"></a><code><span><span class="keyword">val</span> register_format : <span>string <span>&#45;&gt;</span></span> <span><span>(<span class="keyword">module</span> <a href="module-type-Format/index.html">Format</a>)</span> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a new named format module or override one.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_format" class="anchored"><a href="#val-find_format" class="anchor"></a><code><span><span class="keyword">val</span> find_format : <span>string <span>&#45;&gt;</span></span> <span>(<span class="keyword">module</span> <a href="module-type-Format/index.html">Format</a>)</span></span></code></div><div class="spec-doc"><p>Find a format module from its name. May throw <code>Not_found</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-formats" class="anchored"><a href="#val-formats" class="anchor"></a><code><span><span class="keyword">val</span> formats : <span>unit <span>&#45;&gt;</span></span> <span><span>(<span class="keyword">module</span> <a href="module-type-Format/index.html">Format</a>)</span> <a href="../../ocaml/Stdlib/Map/Make/index.html#type-t">Stdlib.Map.Make(Stdlib.String).t</a></span></span></code></div><div class="spec-doc"><p>Retrive the currently available formats</p></div></div><h3 id="subformats-registry"><a href="#subformats-registry" class="anchor"></a>SubFormats registry</h3><div class="odoc-spec"><div class="spec module-type" id="module-type-SubFormat" class="anchored"><a href="#module-type-SubFormat" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-SubFormat/index.html">SubFormat</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The type of subformat plug-ins</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register_subformat" class="anchored"><a href="#val-register_subformat" class="anchor"></a><code><span><span class="keyword">val</span> register_subformat : <span>string <span>&#45;&gt;</span></span> <span><span>(<span class="keyword">module</span> <a href="module-type-SubFormat/index.html">SubFormat</a>)</span> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Register a new named subformat module or override one.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_subformat" class="anchored"><a href="#val-find_subformat" class="anchor"></a><code><span><span class="keyword">val</span> find_subformat : <span>string <span>&#45;&gt;</span></span> <span>(<span class="keyword">module</span> <a href="module-type-SubFormat/index.html">SubFormat</a>)</span></span></code></div><div class="spec-doc"><p>Find a subformat module from its name. May throw <code>Not_found</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-subformats" class="anchored"><a href="#val-subformats" class="anchor"></a><code><span><span class="keyword">val</span> subformats : <span>unit <span>&#45;&gt;</span></span> <span><span>(<span class="keyword">module</span> <a href="module-type-SubFormat/index.html">SubFormat</a>)</span> <a href="../../ocaml/Stdlib/Map/Make/index.html#type-t">Stdlib.Map.Make(Stdlib.String).t</a></span></span></code></div><div class="spec-doc"><p>Retrive the currently available subformats</p></div></div><h3 id="predefined-subformats"><a href="#predefined-subformats" class="anchor"></a>Predefined Subformats</h3><div class="odoc-spec"><div class="spec module" id="module-Raw" class="anchored"><a href="#module-Raw" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Raw/index.html">Raw</a></span><span> : <a href="module-type-SubFormat/index.html">SubFormat</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-SubFormat/index.html#type-t">t</a> = string</span></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;raw&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Int" class="anchored"><a href="#module-Int" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Int/index.html">Int</a></span><span> : <a href="module-type-SubFormat/index.html">SubFormat</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-SubFormat/index.html#type-t">t</a> = int</span></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;int&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Lines" class="anchored"><a href="#module-Lines" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Lines/index.html">Lines</a></span><span> : <a href="module-type-SubFormat/index.html">SubFormat</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-SubFormat/index.html#type-t">t</a> = <span>string list</span></span></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;lines&quot;</code>.</p></div></div><h3 id="predefined-formats"><a href="#predefined-formats" class="anchor"></a>Predefined Formats</h3><div class="odoc-spec"><div class="spec module" id="module-PredefOptions" class="anchored"><a href="#module-PredefOptions" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="PredefOptions/index.html">PredefOptions</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Predefined options that you can use in your own formats</p></div></div><div class="odoc-spec"><div class="spec module" id="module-ExtensionDispatcherSubFormat" class="anchored"><a href="#module-ExtensionDispatcherSubFormat" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="ExtensionDispatcherSubFormat/index.html">ExtensionDispatcherSubFormat</a></span><span> : <a href="../OCamlResSubFormats/module-type-SubFormat/index.html">OCamlResSubFormats.SubFormat</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../OCamlResSubFormats/module-type-SubFormat/index.html#type-t">t</a> = string</span></span></code></div><div class="spec-doc"><p>Output subformat dispatching the output depending on file extensions and the command line options. To be polymorphic, the <code>t</code> type is a string containing the raw resource representation, and the <code>from_raw</code> method of the selected subformat is used at every operation. The <code>SubFormat</code> used is resolved using table <a href="PredefOptions/index.html#val-subformats"><code>PredefOptions.subformats</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-disclaimer" class="anchored"><a href="#val-disclaimer" class="anchor"></a><code><span><span class="keyword">val</span> disclaimer : string</span></code></div><div class="spec-doc"><p>Disclaimer that you can use in your own formats</p></div></div><div class="odoc-spec"><div class="spec module" id="module-OCaml" class="anchored"><a href="#module-OCaml" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="OCaml/index.html">OCaml</a></span><span> : <a href="module-type-Format/index.html">Format</a></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;ocaml&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Res" class="anchored"><a href="#module-Res" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Res/index.html">Res</a></span><span> : <a href="module-type-Format/index.html">Format</a></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;ocamlres&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Variants" class="anchored"><a href="#module-Variants" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Variants/index.html">Variants</a></span><span> : <a href="module-type-Format/index.html">Format</a></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;variants&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Files" class="anchored"><a href="#module-Files" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Files/index.html">Files</a></span><span> : <a href="module-type-Format/index.html">Format</a></span></code></div><div class="spec-doc"><p>Registered under the name <code>&quot;files&quot;</code>.</p></div></div></div></body></html>