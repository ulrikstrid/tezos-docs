<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tezos_store__Floating_block_store (tezos-store.Tezos_store__Floating_block_store)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">tezos-store</a> &#x00BB; Tezos_store__Floating_block_store</nav><header class="odoc-preamble"><h1>Module <code><span>Tezos_store__Floating_block_store</span></code></h1><p>Persistent block store with arborescent history</p><p>The floating block store is an append-only store where blocks are stored arbitrarily. This structure possess an indexed map <code>Block_hash</code>.t -&gt; (offset × predecessors) which points to its offset in the associated file along with an exponential list of predecessors block hashes (as implemented in <code>Block_store</code>.compute_predecessors). The structure access/modification is protected by a mutex (<code>Lwt_idle_waiter</code>) and thus can be manipulated concurrently. Stored blocks may or may not contain metadata. The instance maintains an opened file descriptor. Therefore it must be properly closed or it might lead to a file descriptor leak.</p><p>Four different kind of instances are allowed to co-exist for an identical path: - RO, a read-only instance; - RW, a read-write instance - RO_TMP, RW_TMP, read-write instances; - Restore is a generic instance used to wrap leftover instances while fixing a crashed storage. See <code>Block_store</code>.</p><h2 id="invariants"><a href="#invariants" class="anchor"></a>Invariants</h2><p>This store is expected to respect the following invariant:</p><ul><li>Every block stored is correctly indexed.</li></ul><h2 id="files-format"><a href="#files-format" class="anchor"></a>Files format</h2><p>The floating block store is composed of the following files:</p><ul><li>file: /&lt;kind&gt;_floating_block_store, a list of <code>Block_repr</code>.t:</li></ul><p>| &lt;block&gt; * |</p><p>where &lt;kind&gt; is RO(_TMP), RW(_TMP) (see <code>Naming</code>) and &lt;block&gt;, a <code>Block_repr</code>.t value encoded using <code>Block_repr</code>.encoding (thus prefixed by the its size).</p></header><div class="odoc-content"></div></body></html>