<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Acl (resto-acl.Resto_acl.Acl)</title><link rel="stylesheet" href="../../../odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">resto-acl</a> &#x00BB; <a href="../index.html">Resto_acl</a> &#x00BB; Acl</nav><header class="odoc-preamble"><h1>Module <code><span>Resto_acl.Acl</span></code></h1><p>Access Control Lists (ACL): types and values to allow or deny access to specific parts of an API based on path matching.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-chunk_matcher" class="anchored"><a href="#type-chunk_matcher" class="anchor"></a><code><span><span class="keyword">type</span> chunk_matcher</span><span> = </span></code><table><tr id="type-chunk_matcher.Literal" class="anchored"><td class="def variant constructor"><a href="#type-chunk_matcher.Literal" class="anchor"></a><code><span>| </span><span><span class="constructor">Literal</span> <span class="keyword">of</span> string</span></code></td></tr><tr id="type-chunk_matcher.Wildcard" class="anchored"><td class="def variant constructor"><a href="#type-chunk_matcher.Wildcard" class="anchor"></a><code><span>| </span><span><span class="constructor">Wildcard</span></span></code></td></tr></table></div><div class="spec-doc"><p><code>path_matcher</code> is the type of values that describe a path or a set of paths. Specifically,</p><ul><li><code>Literal s</code> matches path chunks that are identical to <code>s</code>,</li><li><code>Wildcard</code> matches any single path chunk,</li><li><code>Exact chunks</code> matches any path the chunks of which match <code>chunks</code> one-by-one,</li><li><code>FollowedByAnySuffix chunks</code> matches any path that is a suffix of a path matched by <code>Exact chunks</code>.</li></ul><p>E.g., <code>Exact [Literal &quot;users&quot;; Wildcard; Literal &quot;display-name&quot;]</code> matches the path <code>&quot;/users/Alice/display-name&quot;</code> and <code>&quot;/users/Bob/display-name&quot;</code>, but not <code>&quot;/users/foo/preferences/&quot;</code>, nor <code>&quot;/users/Bar/display-name/normalised&quot;</code>.</p><p>E.g., <code>FollowedByAnySuffix [Literal &quot;admin&quot;; Literal &quot;keys&quot;]</code> matches the path <code>&quot;/admin/keys&quot;</code> and <code>&quot;admin/keys/gpg&quot;</code>.</p><p>It is recommended that you use <code>FollowedByAnySuffix</code> in order to match a whole directory attached to a given prefix, or a whole set of services that are register under a common prefix.</p><p>It is recommended that you use <code>Wildcard</code> to match path-parameters (such as with the path <code>&quot;/users/&lt;user-id&gt;/&quot;</code>.</p><p>It is _NOT_ recommended that you use <code>Literal _</code> to match on the specific value of a parameter.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-path_matcher" class="anchored"><a href="#type-path_matcher" class="anchor"></a><code><span><span class="keyword">type</span> path_matcher</span><span> = </span></code><table><tr id="type-path_matcher.Exact" class="anchored"><td class="def variant constructor"><a href="#type-path_matcher.Exact" class="anchor"></a><code><span>| </span><span><span class="constructor">Exact</span> <span class="keyword">of</span> <span><a href="#type-chunk_matcher">chunk_matcher</a> list</span></span></code></td></tr><tr id="type-path_matcher.FollowedByAnySuffix" class="anchored"><td class="def variant constructor"><a href="#type-path_matcher.FollowedByAnySuffix" class="anchor"></a><code><span>| </span><span><span class="constructor">FollowedByAnySuffix</span> <span class="keyword">of</span> <span><a href="#type-chunk_matcher">chunk_matcher</a> list</span></span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-meth_matcher" class="anchored"><a href="#type-meth_matcher" class="anchor"></a><code><span><span class="keyword">type</span> meth_matcher</span><span> = </span></code><table><tr id="type-meth_matcher.Exact" class="anchored"><td class="def variant constructor"><a href="#type-meth_matcher.Exact" class="anchor"></a><code><span>| </span><span><span class="constructor">Exact</span> <span class="keyword">of</span> <a href="../../../resto/Resto/index.html#type-meth">Resto.meth</a></span></code></td></tr><tr id="type-meth_matcher.Any" class="anchored"><td class="def variant constructor"><a href="#type-meth_matcher.Any" class="anchor"></a><code><span>| </span><span><span class="constructor">Any</span></span></code></td></tr></table></div><div class="spec-doc"><p><code>meth_matcher</code> is the type of values that describe a method or a set of methods. <code>Exact m</code> matches <code>m</code> whilst <code>Any</code> matches any method.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-matcher" class="anchored"><a href="#type-matcher" class="anchor"></a><code><span><span class="keyword">type</span> matcher</span><span> = </span><span>{</span></code><table><tr id="type-matcher.meth" class="anchored"><td class="def record field"><a href="#type-matcher.meth" class="anchor"></a><code><span>meth : <a href="#type-meth_matcher">meth_matcher</a>;</span></code></td></tr><tr id="type-matcher.path" class="anchored"><td class="def record field"><a href="#type-matcher.path" class="anchor"></a><code><span>path : <a href="#type-path_matcher">path_matcher</a>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-parse" class="anchored"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : <span>string <span>&#45;&gt;</span></span> <a href="#type-matcher">matcher</a></span></code></div><div class="spec-doc"><p><code>parse s</code> parses the string <code>s</code> as a matcher. It raises <code>Invalid_argument</code> if the argument <code>s</code> is not in line with the following format.</p><p>A string representation of a matcher has the following components one after the other.</p><p>1. An optional method. If the method is absent, then <code>Any</code> is the method matcher. If the method is present it must be one of <code>&quot;GET&quot;; &quot;POST&quot;;
       &quot;DELETE&quot;; &quot;PUT&quot;; &quot;PATCH&quot;</code>. 2. Any number (including none (0)) of spaces (<code> </code>). 3. A path which must start with a slash (<code>/</code>) and be followed by a sequence of chunks separated by slashes (<code>/</code>). Each chunk is either a single asterisk (<code>*</code>) (for <code>Wildcard</code>) or a non-empty sequence of characters (for <code>Literal _</code>). Special characters (see below) must be percentage-encoded. 4. An optional suffix slash-star-star (<code>&quot;/**&quot;</code>) indicates <code>FollowedByAnySuffix</code> and it's absence is for <code>Exact</code>.</p><p>E.g., <code>&quot;/**&quot;</code> is a matcher for any method and any path. E.g., <code>&quot;     /**&quot;</code> is the same matcher with extra (ignored) space (for alignment). E.g., <code>&quot;GET  /**&quot;</code> is a matcher for the GET method and any path. E.g., <code>&quot;POST /admin/**&quot;</code> is a matcher for the POST method on any suffix of <code>&quot;/admin&quot;</code>. E.g., <code>&quot;PATCH/*&quot;</code> is a matcher for the PATCH method on any single-chunk path. E.g., <code>&quot;/users/*/display-name&quot;</code> is a matcher for any method on paths that fit in the <code>&quot;/users/&lt;user-id&gt;/display-name&quot;</code> pattern.</p><p>Chunks cannot contain the following special characters. These characters must be represented percent-encoded. (Note that chunks are percent-decoded and the character percent (<code>%</code>) should appear percent-encoded (%25).</p><ul><li>slash (<code>/</code>, represented by %2F)</li><li>asterisk (<code>*</code>, represented by %2A)</li><li>question mark (<code>?</code>, represented by %3F)</li><li>ampersand (<code>&amp;</code>, represented by %26)</li><li>hash (<code>#</code>, represented by %23)</li><li>equal (<code>=</code>, represented by %3D)</li></ul><p>Also note that each chunk is percent-decoded.</p><p>E.g., <code>&quot;GET /entries/by/year/2020/*/*&quot;</code> is a matcher for the GET method on paths that fit in the <code>&quot;/entries/by/year/2020/&lt;month&gt;/&lt;day&gt;&quot;</code> pattern. E.g., <code>&quot;GET /entries/by/year/20*/*/*&quot;</code> is not a valid matcher. The character asterisk (<code>*</code>) is not allowed within literal chunks. To match on the specific string <code>&quot;20*&quot;</code> use the percent-encoding <code>20%2A</code>. You cannot match on regular expressions nor glob expansions using this Acl module.</p><dl><dt>raises {!Invalid_argument}</dt><dd><p>if the path does not follow the format described above.</p></dd></dl></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span></code><table><tr id="type-t.Allow_all" class="anchored"><td class="def variant constructor"><a href="#type-t.Allow_all" class="anchor"></a><code><span>| </span><span><span class="constructor">Allow_all</span> <span class="keyword">of</span> </span><span>{</span></code><table><tr id="type-t.except" class="anchored"><td class="def record field"><a href="#type-t.except" class="anchor"></a><code><span>except : <span><a href="#type-matcher">matcher</a> list</span>;</span></code></td></tr></table><code><span>}</span></code></td><td class="doc"><p>Allow all by default but deny requests matched by the exception list.</p></td></tr><tr id="type-t.Deny_all" class="anchored"><td class="def variant constructor"><a href="#type-t.Deny_all" class="anchor"></a><code><span>| </span><span><span class="constructor">Deny_all</span> <span class="keyword">of</span> </span><span>{</span></code><table><tr id="type-t.except" class="anchored"><td class="def record field"><a href="#type-t.except" class="anchor"></a><code><span>except : <span><a href="#type-matcher">matcher</a> list</span>;</span></code></td></tr></table><code><span>}</span></code></td><td class="doc"><p>Deny all by default but allow requests matched by the exception list.</p></td></tr></table></div><div class="spec-doc"><p>access policy</p></div></div><div class="odoc-spec"><div class="spec value" id="val-allowed" class="anchored"><a href="#val-allowed" class="anchor"></a><code><span><span class="keyword">val</span> allowed : <span><a href="#type-t">t</a> <span>&#45;&gt;</span></span> <span>meth:<a href="../../../resto/Resto/index.html#type-meth">Resto.meth</a> <span>&#45;&gt;</span></span> <span>path:<span>string list</span> <span>&#45;&gt;</span></span> bool</span></code></div></div></div></body></html>