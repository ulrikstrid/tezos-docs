<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Json_repr_bson (json-data-encoding-bson.Json_repr_bson)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">json-data-encoding-bson</a> &#x00BB; Json_repr_bson</nav><header class="odoc-preamble"><h1>Module <code><span>Json_repr_bson</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-bson" class="anchored"><a href="#type-bson" class="anchor"></a><code><span><span class="keyword">type</span> bson</span></code></div><div class="spec-doc"><p>A intermediate representation for BSON, a binary encoding for JSON.</p><p>Decoding and encoding is (optionally) done as lazily as possible. First, the <code>view</code> function is able to unfold only one level and not the whole structure. Also, serialized versions are cached, so that later serializations of the same object are faster.</p><p>Notes:</p><p>1. Only JSON compatible BSON documents are supported. BSON extensions are not supported (int32, int64, timestamp, etc.). 2. Arrays in BSON are stored inefficiently. Prefer another binary format if you manipulate lots of arrays. 3. We differ from BSON to allow toplevel immediates. For this, we produce a document with only one byte indicating the kind of immediate followed by the immediate. The byte is <code>0x80 lor (the corresponding BSON field kind)</code>. 4. We differ from BSON to allow unambiguous toplevel arrays. As with (3), the subdocument to be decoded as an array is preceded with a 0x84.</p><p>Use the <code>conforming</code> flag to deactivates the extension from notes (3) and (4). In this case, the toplevel value must be an object.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Repr" class="anchored"><a href="#module-Repr" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Repr/index.html">Repr</a></span><span> : <a href="../../json-data-encoding/Json_repr/module-type-Repr/index.html">Json_repr.Repr</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../json-data-encoding/Json_repr/module-type-Repr/index.html#type-value">value</a> = <a href="#type-bson">bson</a></span></span></code></div><div class="spec-doc"><p>A view over the <a href="#type-bson"><code>bson</code></a> representation.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Json_encoding" class="anchored"><a href="#module-Json_encoding" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Json_encoding/index.html">Json_encoding</a></span><span> : <a href="../../json-data-encoding/Json_encoding/module-type-S/index.html">Json_encoding.S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../json-data-encoding/Json_encoding/module-type-S/index.html#type-repr_value">repr_value</a> = <a href="#type-bson">bson</a></span></span></code></div><div class="spec-doc"><p>Pre-instanciated <code>Json_encoding</code>.Make.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Json_query" class="anchored"><a href="#module-Json_query" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Json_query/index.html">Json_query</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Pre-instanciated <code>Json_encoding</code>.Make.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bson_to_bytes" class="anchored"><a href="#val-bson_to_bytes" class="anchor"></a><code><span><span class="keyword">val</span> bson_to_bytes : <span>?&#8288;cache:bool <span>&#45;&gt;</span></span> <span>?&#8288;conforming:bool <span>&#45;&gt;</span></span> <span><a href="#type-bson">bson</a> <span>&#45;&gt;</span></span> bytes</span></code></div><div class="spec-doc"><p>Serializes the intermediate BSON representation to actual BSON.</p><p>By default, <code>conforming</code> is <code>false</code>, so that any value can be serialized, including immediates (see <a href="#type-bson"><code>bson</code></a>).</p><p>By default, <code>cache</code> is <code>true</code>, so a future serialization of the same data will be faster. The resulting bytes are stored in the value. You may want to turn this off if these values have a long lifespan, and that you care more about memory consumption than serialization speed.</p><p>Will raise <code>Invalid_argument &quot;Json_repr.bson_to_bytes&quot;</code> when <code>conforming</code> and trying to serialize a toplevel array or immediate.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Bson_decoding_error" class="anchored"><a href="#exception-Bson_decoding_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Bson_decoding_error</span> <span class="keyword">of</span> string * bytes * int</span></code></div><div class="spec-doc"><p>Bson decoding error, with a message, the BSON and an offset.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bytes_to_bson" class="anchored"><a href="#val-bytes_to_bson" class="anchor"></a><code><span><span class="keyword">val</span> bytes_to_bson : <span>?&#8288;laziness:bool <span>&#45;&gt;</span></span> <span>?&#8288;cache:bool <span>&#45;&gt;</span></span> <span>?&#8288;conforming:bool <span>&#45;&gt;</span></span> <span>copy:bool <span>&#45;&gt;</span></span>
<span>bytes <span>&#45;&gt;</span></span> <a href="#type-bson">bson</a></span></code></div><div class="spec-doc"><p>Creates a lazily unfolded representation for some BSON. Because of the mutability of <code>bytes</code> and this laziness, set the copy parameter to <code>true</code> if you are not sure that the <code>bytes</code> will not be mutated in the future.</p><p>By default, <code>conforming</code> is <code>false</code>, so that any value can be serialized, including immediates (see <a href="#type-bson"><code>bson</code></a>).</p><p>By default, <code>cache</code> is <code>true</code>, so a future serialization of the same data will be faster. The input bytes are stored in the value. You may want to turn this off if these values have a long lifespan, and that you care more about memory consumption than serialization speed.</p><p>By default, <code>laziness</code> is <code>true</code>. If the data is a serialized object, it means that only the field names are read, the field values are eluded, and will be deserialized on demand when calling <code>Repr.view</code>. This implies that <a href="#exception-Bson_decoding_error"><code>Bson_decoding_error</code></a> may be raised later. If set to <code>false</code>, the whole structure is decoded upfront, so any decoding error will happen at this point. This may be preferable mostly when reading from untusted sources.</p><p>May raise <a href="#exception-Bson_decoding_error"><code>Bson_decoding_error</code></a>.</p></div></div></div></body></html>