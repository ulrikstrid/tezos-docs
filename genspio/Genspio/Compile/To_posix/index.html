<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>To_posix (genspio.Genspio.Compile.To_posix)</title><link rel="stylesheet" href="../../../../odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">genspio</a> &#x00BB; <a href="../../index.html">Genspio</a> &#x00BB; <a href="../index.html">Compile</a> &#x00BB; To_posix</nav><header class="odoc-preamble"><h1>Module <code><span>Compile.To_posix</span></code></h1><p>Compiler from <a href="../../EDSL/index.html#type-t"><code>EDSL.t</code></a> to POSIX shell scripts (one-liners or multiline scripts).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-internal_error_details" class="anchored"><a href="#type-internal_error_details" class="anchor"></a><code><span><span class="keyword">type</span> internal_error_details</span><span> = <a href="../../Standard_compiler/index.html#type-internal_error_details">Standard_compiler.internal_error_details</a></span><span> = </span><span>{</span></code><table><tr id="type-internal_error_details.variable" class="anchored"><td class="def record field"><a href="#type-internal_error_details.variable" class="anchor"></a><code><span>variable : string;</span></code></td><td class="doc"><p>The incriminated issue was stored in a shell variable.</p></td></tr><tr id="type-internal_error_details.content" class="anchored"><td class="def record field"><a href="#type-internal_error_details.content" class="anchor"></a><code><span>content : string;</span></code></td><td class="doc"><p>The shell-code that produced the <code>variable</code>.</p></td></tr><tr id="type-internal_error_details.code" class="anchored"><td class="def record field"><a href="#type-internal_error_details.code" class="anchor"></a><code><span>code : string;</span></code></td><td class="doc"><p>Pretty-printed version of the above EDSL code.</p></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>When a compiled script runs into an error, these details are accessible to the user.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-death_message" class="anchored"><a href="#type-death_message" class="anchor"></a><code><span><span class="keyword">type</span> death_message</span><span> = <a href="../../Standard_compiler/index.html#type-death_message">Standard_compiler.death_message</a></span><span> = </span></code><table><tr id="type-death_message.User" class="anchored"><td class="def variant constructor"><a href="#type-death_message.User" class="anchor"></a><code><span>| </span><span><span class="constructor">User</span> <span class="keyword">of</span> string</span></code></td><td class="doc"><p>The argument of the <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> is the “user” case.</p></td></tr><tr id="type-death_message.C_string_failure" class="anchored"><td class="def variant constructor"><a href="#type-death_message.C_string_failure" class="anchor"></a><code><span>| </span><span><span class="constructor">C_string_failure</span> <span class="keyword">of</span> <a href="#type-internal_error_details">internal_error_details</a></span></code></td><td class="doc"><p>The checking that a byte-array <i>is</i> a C-String can fail when the byte-array contains <code>'\x00'</code>.</p></td></tr><tr id="type-death_message.String_to_int_failure" class="anchored"><td class="def variant constructor"><a href="#type-death_message.String_to_int_failure" class="anchor"></a><code><span>| </span><span><span class="constructor">String_to_int_failure</span> <span class="keyword">of</span> <a href="#type-internal_error_details">internal_error_details</a></span></code></td><td class="doc"><p><code>string_to_int</code> can obviously fail.</p></td></tr></table></div><div class="spec-doc"><p>The kinds of messages that can be output or stored before exiting a script.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-death_function" class="anchored"><a href="#type-death_function" class="anchor"></a><code><span><span class="keyword">type</span> death_function</span><span> = <span>comment_stack:<span>string list</span> <span>&#45;&gt;</span></span> <span><a href="#type-death_message">death_message</a> <span>&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>When failing (either with <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> or because of internal reasons) the compiler uses a customizable function to output the “error” message and then quiting the process.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-compilation_error" class="anchored"><a href="#type-compilation_error" class="anchor"></a><code><span><span class="keyword">type</span> compilation_error</span><span> = <a href="../../Standard_compiler/index.html#type-compilation_error">Standard_compiler.compilation_error</a></span><span> = </span><span>{</span></code><table><tr id="type-compilation_error.error" class="anchored"><td class="def record field"><a href="#type-compilation_error.error" class="anchor"></a><code><span>error : <span>[ <span>`No_fail_configured of <a href="#type-death_message">death_message</a></span> <span><span>| `Max_argument_length</span> of string</span> <span><span>| `Not_a_c_string</span> of string</span> ]</span>;</span></code></td><td class="doc"><p>Error description.</p></td></tr><tr id="type-compilation_error.code" class="anchored"><td class="def record field"><a href="#type-compilation_error.code" class="anchor"></a><code><span>code : <span>string option</span>;</span></code></td><td class="doc"><p>Chunk of relevant, pretty-printed EDSL code.</p></td></tr><tr id="type-compilation_error.comment_backtrace" class="anchored"><td class="def record field"><a href="#type-compilation_error.comment_backtrace" class="anchor"></a><code><span>comment_backtrace : <span>string list</span>;</span></code></td><td class="doc"><p>Stack of `Comment` constructs at the point of the error.</p></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The potential compilation error.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_error" class="anchored"><a href="#val-pp_error" class="anchor"></a><code><span><span class="keyword">val</span> pp_error : <span><a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span></span> <span><a href="#type-compilation_error">compilation_error</a> <span>&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Printer for error values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-error_to_string" class="anchored"><a href="#val-error_to_string" class="anchor"></a><code><span><span class="keyword">val</span> error_to_string : <span><a href="#type-compilation_error">compilation_error</a> <span>&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Convenience display of error values.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-parameters" class="anchored"><a href="#type-parameters" class="anchor"></a><code><span><span class="keyword">type</span> parameters</span><span> = </span><span>{</span></code><table><tr id="type-parameters.style" class="anchored"><td class="def record field"><a href="#type-parameters.style" class="anchor"></a><code><span>style : <span>[ `Multi_line <span>| `One_liner</span> ]</span>;</span></code></td><td class="doc"><p>The kind of script to output: in one-liners sequences are separated with <code>&quot;;&quot;</code>, in multi-line scripts, sequences are separated with new lines.</p></td></tr><tr id="type-parameters.max_argument_length" class="anchored"><td class="def record field"><a href="#type-parameters.max_argument_length" class="anchor"></a><code><span>max_argument_length : <span>int option</span>;</span></code></td><td class="doc"><p>A limit on the length of the literal command line arguments generated by the compiler.</p><ul><li><code>None</code> means “do not check.”</li><li>The default value for is <code>Some 100_000</code>, meaning that ≥ 100 000 B arguments will make the compiler fail with an exception.</li></ul></td></tr><tr id="type-parameters.fail_with" class="anchored"><td class="def record field"><a href="#type-parameters.fail_with" class="anchor"></a><code><span>fail_with : <span>[ <span>`Kill of string</span> <span>| `Nothing</span> <span><span>| `Trap_and_kill</span> of int * string</span> ]</span>;</span></code></td><td class="doc"><p>How to implement the <code>EDSL.fail</code> construct (which appears also internally e.g. when <code>EDSL</code>.to_c_string fails.).</p><ul><li><code>`Nothing</code>: the compiler will fail to compile <code>fail</code> constructs.</li><li><code>`Kill signal_name</code>: the compiler will store the “toplevel” process id of the script and <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> will be trying to kill the script with the signal <code>signal_name</code> (e.g. <code>&quot;USR2&quot;</code>).</li><li><code>`Trap_and_kill (exit_status, signal_name)</code>: the <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> construct will kill the script with <code>signal_name</code> <b>and</b> the signal will be caught with the POSIX <code>&quot;trap&quot;</code> command in order to exit with <code>exit_status</code>.</li></ul></td></tr><tr id="type-parameters.print_failure" class="anchored"><td class="def record field"><a href="#type-parameters.print_failure" class="anchor"></a><code><span>print_failure : <a href="#type-death_function">death_function</a>;</span></code></td><td class="doc"><p>How to deal with the <a href="#type-death_message"><code>death_message</code></a> in case of failure. The function should return a shell command, like the result of compiling a <code>unit EDSL.t</code> expression or what <code>Sys</code>.command can work with.</p></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Configuration of the compilation to POSIX shell scripts.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-failure_to_stderr" class="anchored"><a href="#val-failure_to_stderr" class="anchor"></a><code><span><span class="keyword">val</span> failure_to_stderr : <a href="#type-death_function">death_function</a></span></code></div><div class="spec-doc"><p>The default <a href="#type-death_function"><code>death_function</code></a> just prints to <code>stderr</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-one_liner" class="anchored"><a href="#val-one_liner" class="anchor"></a><code><span><span class="keyword">val</span> one_liner : <a href="#type-parameters">parameters</a></span></code></div><div class="spec-doc"><p>The default parameters for one-liners: </p><pre><code>{
  style = `One_liner;
  max_argument_length = Some 100_000;
  fail_with = `Trap_and_kill (78, &quot;USR2&quot;);
  print_failure = failure_to_stderr;
}</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-multi_line" class="anchored"><a href="#val-multi_line" class="anchor"></a><code><span><span class="keyword">val</span> multi_line : <a href="#type-parameters">parameters</a></span></code></div><div class="spec-doc"><p>The default parameters for multi-liners (similar to <a href="#val-one_liner"><code>one_liner</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_options" class="anchored"><a href="#val-default_options" class="anchor"></a><code><span><span class="keyword">val</span> default_options : <a href="#type-parameters">parameters</a></span></code></div><div class="spec-doc"><p>The default value for <code>?option</code> in <a href="#val-string"><code>string</code></a>, which is <a href="#val-one_liner"><code>one_liner</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>?&#8288;options:<a href="#type-parameters">parameters</a> <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../../EDSL/index.html#type-t">EDSL.t</a></span> <span>&#45;&gt;</span></span> <span><span>(string, <a href="#type-compilation_error">compilation_error</a>)</span> <a href="../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></span></span></code></div><div class="spec-doc"><p>Compile a Genspio expression to a POSIX shell “phrase” (one-liner or multi-line) according to the <code>?options</code> (see <a href="#type-parameters"><code>parameters</code></a>).</p></div></div></div></body></html>