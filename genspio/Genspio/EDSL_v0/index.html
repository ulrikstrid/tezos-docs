<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>EDSL_v0 (genspio.Genspio.EDSL_v0)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0-beta2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">genspio</a> &#x00BB; <a href="../index.html">Genspio</a> &#x00BB; EDSL_v0</nav><header class="odoc-preamble"><h1>Module <code><span>Genspio.EDSL_v0</span></code></h1><p>The “legacy” Embedded Domain Specific Lanaguage.”</p><p>This is the 0.1.0 version of the EDSL. It is lower-level than <code>EDSL</code> as it explicitly separates the types <code>byte_array</code> and <code>c_string</code> while the functions in the <code>EDSL</code> module <i>“hide”</i> the conversions <code>byte_array</code> → <code>c_string</code> in the API.</p></header><nav class="odoc-toc"><ul><li><a href="#literals">Literals</a></li><li><a href="#comments">Comments</a></li><li><a href="#basic-system-commands">Basic system Commands</a></li><li><a href="#boolean-expressions">Boolean Expressions</a></li><li><a href="#integer-arithmetic">Integer Arithmetic</a></li><li><a href="#edsl-lists">EDSL Lists</a></li><li><a href="#string-manipulation">String Manipulation</a></li><li><a href="#control-flow">Control Flow</a></li><li><a href="#switch-statements">Switch Statements</a></li><li><a href="#redirections-and-file-descriptors">Redirections and File Descriptors</a></li><li><a href="#escaping-the-execution-flow">Escaping The Execution Flow</a></li><li><a href="#temporary-files">Temporary Files</a></li><li><a href="#command-line-parsing">Command Line Parsing</a></li><li><a href="#additional-higher-level-utilities">Additional Higher-Level Utilities</a></li><li><a href="#very-unsafe-operations">Very Unsafe Operations</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span><span> = <span><span class="type-var">'a</span> <a href="../Language/index.html#type-t">Language.t</a></span></span></code></div><div class="spec-doc"><p>The type of a Genspio expression.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-byte_array" class="anchored"><a href="#type-byte_array" class="anchor"></a><code><span><span class="keyword">type</span> byte_array</span><span> = <a href="../Language/index.html#type-byte_array">Language.byte_array</a></span></code></div><div class="spec-doc"><p>Type to encode arbitrary byte-arrays in the EDSL as <code>byte_array t</code> values, OCaml literal strings or the outputs (as in <code>stdout</code>) of processes are byte-arrays.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-c_string" class="anchored"><a href="#type-c_string" class="anchor"></a><code><span><span class="keyword">type</span> c_string</span><span> = <a href="../Language/index.html#type-c_string">Language.c_string</a></span></code></div><div class="spec-doc"><p>Type to encode NUL-terminated strings in the EDSL as <code>c_string t</code> values. C-strings cannot contain the <code>'\x00'</code> character. The command line arguments of commands as well as the contents of environment variables must be C-strings.</p></div></div><h4 id="literals"><a href="#literals" class="anchor"></a>Literals</h4><div class="odoc-spec"><div class="spec value" id="val-c_string" class="anchored"><a href="#val-c_string" class="anchor"></a><code><span><span class="keyword">val</span> c_string : <span>string <span>&#45;&gt;</span></span> <span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create a <a href="#type-c_string"><code>c_string</code></a> literal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <span>&#45;&gt;</span></span> <span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string</code> is an alias for <code>function:c_string</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-byte_array" class="anchored"><a href="#val-byte_array" class="anchor"></a><code><span><span class="keyword">val</span> byte_array : <span>string <span>&#45;&gt;</span></span> <span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create a <a href="#type-byte_array"><code>byte_array</code></a> literal.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <span>&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><h4 id="comments"><a href="#comments" class="anchor"></a>Comments</h4><div class="odoc-spec"><div class="spec value" id="val-comment" class="anchored"><a href="#val-comment" class="anchor"></a><code><span><span class="keyword">val</span> comment : <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Add a “comment” string to an expression (will be displayed in error messages happening inside the expression).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(%%%)" class="anchored"><a href="#val-(%%%)" class="anchor"></a><code><span><span class="keyword">val</span> (%%%) : <span>string <span>&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>&quot;Some comment&quot; %%% expr</code> is an alias for <code>comment &quot;Some comment&quot; expr</code>.</p></div></div><h4 id="basic-system-commands"><a href="#basic-system-commands" class="anchor"></a>Basic system Commands</h4><div class="odoc-spec"><div class="spec value" id="val-call" class="anchored"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : <span><span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Call a command from its list of “arguments” (including the first argument being the actual command).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : <span><span>string list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Like <a href="#val-call"><code>call</code></a> but with string literals; i.e. <code>exec [&quot;a&quot;; &quot;b&quot;]</code> is actually <code>call [string &quot;a&quot;; string &quot;b&quot;]</code> which is the usual shell command <code>&quot;a b&quot;</code> (with proper escaping).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-getenv" class="anchored"><a href="#val-getenv" class="anchor"></a><code><span><span class="keyword">val</span> getenv : <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Get the value of an environment variable as a string; it returns the empty string when the variable is not defined. If the argument is not a valid variable name, behavior is undefined.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-setenv" class="anchored"><a href="#val-setenv" class="anchor"></a><code><span><span class="keyword">val</span> setenv : <span>var:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Set the value of an environment variable as a string; it returns the empty string is the variable is not defined.</p><p>If the <code>~var</code> argument is not a valid variable name or if the value does not fit in a shell variable (e.g. newlines), behavior is undefined.</p><p>Also, the total environment of a UNIX process counts towards the total size of the arguments passed on to a sub-process (see usually the result of <code>&quot;getconf ARG_MAX&quot;</code>). Genspio does not check for that limit which is not that high in some operating systems (e.g. about 200 KiB on the <i>MacOSX Sierra</i> that the Travis CI runs …). You might prefer putting or accumulating things in a <a href="#val-tmp_file"><code>tmp_file</code></a>.</p></div></div><h4 id="boolean-expressions"><a href="#boolean-expressions" class="anchor"></a>Boolean Expressions</h4><div class="odoc-spec"><div class="spec value" id="val-(&amp;&amp;&amp;)" class="anchored"><a href="#val-(&amp;&amp;&amp;)" class="anchor"></a><code><span><span class="keyword">val</span> (&amp;&amp;&amp;) : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-(|||)" class="anchored"><a href="#val-(|||)" class="anchor"></a><code><span><span class="keyword">val</span> (|||) : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-not" class="anchored"><a href="#val-not" class="anchor"></a><code><span><span class="keyword">val</span> not : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-returns" class="anchored"><a href="#val-returns" class="anchor"></a><code><span><span class="keyword">val</span> returns : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>value:int <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Check the return value of a command/expression/script.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-succeeds" class="anchored"><a href="#val-succeeds" class="anchor"></a><code><span><span class="keyword">val</span> succeeds : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>succeeds expr</code> is equivalent to <code>returns expr ~value:0</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-file_exists" class="anchored"><a href="#val-file_exists" class="anchor"></a><code><span><span class="keyword">val</span> file_exists : <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Check whether a file exists, i.e. a shortcut for <code>call [c_string &quot;test&quot;; c_string &quot;-f&quot;; path] |&gt; succeeds</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Bool" class="anchored"><a href="#module-Bool" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Bool/index.html">Bool</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Conversions of the <code>bool t</code> type.</p></div></div><h4 id="integer-arithmetic"><a href="#integer-arithmetic" class="anchor"></a>Integer Arithmetic</h4><div class="odoc-spec"><div class="spec module" id="module-Integer" class="anchored"><a href="#module-Integer" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Integer/index.html">Integer</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Functions on <code>int t</code> values (arithmetic, comparisons, conversions, etc.).</p></div></div><h4 id="edsl-lists"><a href="#edsl-lists" class="anchor"></a>EDSL Lists</h4><div class="odoc-spec"><div class="spec module" id="module-Elist" class="anchored"><a href="#module-Elist" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Elist/index.html">Elist</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Functions on <code>'a list t</code> values.</p></div></div><h4 id="string-manipulation"><a href="#string-manipulation" class="anchor"></a>String Manipulation</h4><div class="odoc-spec"><div class="spec module" id="module-Byte_array" class="anchored"><a href="#module-Byte_array" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Byte_array/index.html">Byte_array</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-C_string" class="anchored"><a href="#module-C_string" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="C_string/index.html">C_string</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h4 id="control-flow"><a href="#control-flow" class="anchor"></a>Control Flow</h4><div class="odoc-spec"><div class="spec value" id="val-nop" class="anchored"><a href="#val-nop" class="anchor"></a><code><span><span class="keyword">val</span> nop : <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>The silent “no-operation.”</p></div></div><div class="odoc-spec"><div class="spec value" id="val-if_then_else" class="anchored"><a href="#val-if_then_else" class="anchor"></a><code><span><span class="keyword">val</span> if_then_else : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-if_then" class="anchored"><a href="#val-if_then" class="anchor"></a><code><span><span class="keyword">val</span> if_then : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-seq" class="anchored"><a href="#val-seq" class="anchor"></a><code><span><span class="keyword">val</span> seq : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Sequence a list of expressions into an expression.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-loop_while" class="anchored"><a href="#val-loop_while" class="anchor"></a><code><span><span class="keyword">val</span> loop_while : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>body:<span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Build a while loop.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-loop_seq_while" class="anchored"><a href="#val-loop_seq_while" class="anchor"></a><code><span><span class="keyword">val</span> loop_seq_while : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>loop_seq_while condition body</code> is a shortcut for <code>loop_while condition ~body:(seq body)</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-if_seq" class="anchored"><a href="#val-if_seq" class="anchor"></a><code><span><span class="keyword">val</span> if_seq : <span>t:<span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>?&#8288;e:<span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>if_seq c ~t ~e</code> is an alternate API for <a href="#val-if_then_else"><code>if_then_else</code></a> (when <code>?e</code> is provided) or <a href="#val-if_then"><code>if_then</code></a> (otherwise) that takes “then” and “else” bodies which are lists for the <a href="#val-seq"><code>seq</code></a> construct.</p></div></div><h4 id="switch-statements"><a href="#switch-statements" class="anchor"></a>Switch Statements</h4><div class="odoc-spec"><div class="spec value" id="val-switch" class="anchored"><a href="#val-switch" class="anchor"></a><code><span><span class="keyword">val</span> switch : <span><span><span>[ <span>`Case of <span>bool <a href="#type-t">t</a></span> * <span>unit <a href="#type-t">t</a></span></span> <span><span>| `Default</span> of <span>unit <a href="#type-t">t</a></span></span> ]</span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create a switch statement from a list of <a href="#val-case"><code>case</code></a> and optionally a <a href="#val-default"><code>default</code></a> (the function raises an exception if there are more than one default cases).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-case" class="anchored"><a href="#val-case" class="anchor"></a><code><span><span class="keyword">val</span> case : <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>[&gt; <span>`Case of <span>bool <a href="#type-t">t</a></span> * <span>unit <a href="#type-t">t</a></span></span> ]</span></span></code></div><div class="spec-doc"><p>Create a normal case for a <a href="#val-switch"><code>switch</code></a> statement.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default" class="anchored"><a href="#val-default" class="anchor"></a><code><span><span class="keyword">val</span> default : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>[&gt; <span>`Default of <span>unit <a href="#type-t">t</a></span></span> ]</span></span></code></div><div class="spec-doc"><p>Create the default case for a <a href="#val-switch"><code>switch</code></a> statement.</p></div></div><h4 id="redirections-and-file-descriptors"><a href="#redirections-and-file-descriptors" class="anchor"></a>Redirections and File Descriptors</h4><div class="odoc-spec"><div class="spec type" id="type-fd_redirection" class="anchored"><a href="#type-fd_redirection" class="anchor"></a><code><span><span class="keyword">type</span> fd_redirection</span></code></div><div class="spec-doc"><p>Abstract type of file-descriptor redirections.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_fd" class="anchored"><a href="#val-to_fd" class="anchor"></a><code><span><span class="keyword">val</span> to_fd : <span><span>int <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <a href="#type-fd_redirection">fd_redirection</a></span></code></div><div class="spec-doc"><p>Create a file-descriptor to file-descriptor redirection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_file" class="anchored"><a href="#val-to_file" class="anchor"></a><code><span><span class="keyword">val</span> to_file : <span><span>int <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <a href="#type-fd_redirection">fd_redirection</a></span></code></div><div class="spec-doc"><p>Create a file-descriptor to file redirection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-with_redirections" class="anchored"><a href="#val-with_redirections" class="anchor"></a><code><span><span class="keyword">val</span> with_redirections : <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><a href="#type-fd_redirection">fd_redirection</a> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Run a <code>unit t</code> expression after applying a list of file-descriptor redirections.</p><p>The redirections are applied in the list's order (which means they can be more easily <i>followed</i> in reverse order), see the “Arbitrary Redirections” example.</p><p>Invalid cases, like redirecting to a file-descriptor has not been opened, lead to undefined behavior; see <a href="https://github.com/hammerlab/genspio/issues/41">issue #41</a>. If the shell is POSIX, the whole expression <code>with_redirections expr redirs</code> exits and its return value is in <code>[1, 125]</code>; if the shell is <code>&quot;bash&quot;</code> or <code>&quot;zsh&quot;</code>, the failing redirection is just ignored and <code>expr</code> is executed with the remaining redirections if any.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_output" class="anchored"><a href="#val-write_output" class="anchor"></a><code><span><span class="keyword">val</span> write_output : <span>?&#8288;stdout:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>?&#8288;stderr:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>?&#8288;return_value:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Redirect selected streams or the return value to files (<code>stdout</code>, <code>stderr</code>, <code>return_value</code> are paths).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write_stdout" class="anchored"><a href="#val-write_stdout" class="anchor"></a><code><span><span class="keyword">val</span> write_stdout : <span>path:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>write_stdout ~path expr</code> is <code>write_output expr ~stdout:path</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pipe" class="anchored"><a href="#val-pipe" class="anchor"></a><code><span><span class="keyword">val</span> pipe : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Pipe commands together (<code>&quot;stdout&quot;</code> into <code>&quot;stdin&quot;</code> exactly like the <code>&quot; | &quot;</code> operator).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(||&gt;)" class="anchored"><a href="#val-(||&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (||&gt;) : <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>a ||&gt; b</code> is a shortcut for <code>pipe [a; b]</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_stdout" class="anchored"><a href="#val-get_stdout" class="anchor"></a><code><span><span class="keyword">val</span> get_stdout : <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Get the contents of <code>stdout</code> into a byte array (in previous versions this function was called <code>output_as_string</code>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-feed" class="anchored"><a href="#val-feed" class="anchor"></a><code><span><span class="keyword">val</span> feed : <span>string:<span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Feed some content (<code>~string</code>) into the <code>&quot;stdin&quot;</code> filedescriptor of a <code>unit t</code> expression.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(&gt;&gt;)" class="anchored"><a href="#val-(&gt;&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;) : <span><span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>str &gt;&gt; cmd</code> is <code>feed ~string:str cmd</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-printf" class="anchored"><a href="#val-printf" class="anchor"></a><code><span><span class="keyword">val</span> printf : <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>printf fmt l</code> is <code>call (string &quot;printf&quot; :: string &quot;--&quot; :: fmt :: l)</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-eprintf" class="anchored"><a href="#val-eprintf" class="anchor"></a><code><span><span class="keyword">val</span> eprintf : <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span><span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Like <a href="#val-printf"><code>printf</code></a> but redirected to <code>&quot;stderr&quot;</code>.</p></div></div><h4 id="escaping-the-execution-flow"><a href="#escaping-the-execution-flow" class="anchor"></a>Escaping The Execution Flow</h4><div class="odoc-spec"><div class="spec value" id="val-fail" class="anchored"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span>string <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Expression that aborts the whole script/command immediately, it will try to output its argument to <code>stderr</code> (but this may be silent depending on the redirections active at a given time).</p></div></div><h4 id="temporary-files"><a href="#temporary-files" class="anchor"></a>Temporary Files</h4><div class="odoc-spec"><div class="spec type" id="type-file" class="anchored"><a href="#type-file" class="anchor"></a><code><span><span class="keyword">type</span> file</span><span> = <span>&lt; get : <span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span>; get_c : <span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span>; set : <span><span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>; set_c : <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>; append : <span><span><a href="#type-byte_array">byte_array</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>; delete : <span>unit <a href="#type-t">t</a></span>; path : <span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span>; &gt;</span></span></code></div><div class="spec-doc"><p>Abstraction of a file, cf. <a href="#val-tmp_file"><code>tmp_file</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tmp_file" class="anchored"><a href="#val-tmp_file" class="anchor"></a><code><span><span class="keyword">val</span> tmp_file : <span>?&#8288;tmp_dir:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>string <span>&#45;&gt;</span></span> <a href="#type-file">file</a></span></code></div><div class="spec-doc"><p>Create a temporary file that may contain arbitrary strings (can be used as variable containing <code>string t</code> values).</p><p><code>tmp_file &quot;foo&quot;</code> points to a path that is a <b>function</b> of the string <code>&quot;foo&quot;</code>; it does not try to make temporary-files unique, on the contrary: two calls to <code>tmp_file &quot;foo&quot;</code> ensure that it is the same file.</p></div></div><h4 id="command-line-parsing"><a href="#command-line-parsing" class="anchor"></a>Command Line Parsing</h4><div class="odoc-spec"><div class="spec module" id="module-Command_line" class="anchored"><a href="#module-Command_line" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Command_line/index.html">Command_line</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Typed command-line parsing for your shell scripts, à la <code>Printf</code>.scanf.</p></div></div><h4 id="additional-higher-level-utilities"><a href="#additional-higher-level-utilities" class="anchor"></a>Additional Higher-Level Utilities</h4><div class="odoc-spec"><div class="spec value" id="val-loop_until_true" class="anchored"><a href="#val-loop_until_true" class="anchor"></a><code><span><span class="keyword">val</span> loop_until_true : <span>?&#8288;attempts:int <span>&#45;&gt;</span></span> <span>?&#8288;sleep:int <span>&#45;&gt;</span></span>
<span>?&#8288;on_failed_attempt:<span>(<span><span>int <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>loop_until_true eval_condition</code> tries to run <code>eval_condition</code> in a loop until it succeeds. It makes <code>~attempts</code> attemps (default 20), and sleeps for <code>sleep</code> seconds (default 2) after each failed attempt. The argument <code>~on_failed_attempt</code> can be used for instance to display something between each failed attempt and the call to <code>sleep</code>, the default is </p><pre><code>fun nth -&gt; printf (string &quot;%d.&quot;) [Integer.to_string nth]</code></pre><p>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-silently" class="anchored"><a href="#val-silently" class="anchor"></a><code><span><span class="keyword">val</span> silently : <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>silently expr</code> is <code>expr</code> with <code>stdout</code> and <code>stderr</code> redirected to <code>&quot;/dev/null&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-succeeds_silently" class="anchored"><a href="#val-succeeds_silently" class="anchor"></a><code><span><span class="keyword">val</span> succeeds_silently : <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>succeeds_silently u</code> <i>is</i> <code>silently u |&gt; succeeds</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-seq_and" class="anchored"><a href="#val-seq_and" class="anchor"></a><code><span><span class="keyword">val</span> seq_and : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> <span>&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>seq_and [a; b; c]</code> is like <code>succeeds a &amp;&amp;&amp; succeeds b &amp;&amp;&amp; succeeds c</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-output_markdown_code" class="anchored"><a href="#val-output_markdown_code" class="anchor"></a><code><span><span class="keyword">val</span> output_markdown_code : <span>string <span>&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>output_markdown_code &quot;ocaml&quot; (exec [&quot;echo&quot;; &quot;let x = 42&quot;])</code> runs its second argument within markdown-like code fences.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-cat_markdown" class="anchored"><a href="#val-cat_markdown" class="anchor"></a><code><span><span class="keyword">val</span> cat_markdown : <span>string <span>&#45;&gt;</span></span> <span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>cat_markdown tag path</code> outputs the contents of the file at <code>path</code> (with <code>&quot;cat&quot;</code>) within a markdown code bloc.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check_sequence" class="anchored"><a href="#val-check_sequence" class="anchor"></a><code><span><span class="keyword">val</span> check_sequence : <span>?&#8288;verbosity:<span>[ <span>`Announce of string</span> <span>| `Output_all</span> <span>| `Silent</span> ]</span>
<span>&#45;&gt;</span></span> <span>?&#8288;on_failure:<span>(<span>step:<span>(string * <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span> <span>stdout:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>stderr:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span>
<span>?&#8288;on_success:<span>(<span>step:<span>(string * <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span> <span>stdout:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>stderr:<span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span>
<span>?&#8288;tmpdir:string <span>&#45;&gt;</span></span> <span><span><span>(string * <span>unit <a href="#type-t">t</a></span>)</span> list</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Run a sequence of expressions until the first that fails:</p><ul><li><p><code>?verbosity</code> configures the output behavior, </p><ul><li><code>`Announce prompt</code> uses <code>prompt</code> to output the name-tag of the command, the output of the command is redirected to temporary files (accessible through the <code>~on_success</code> and <code>~on_failure</code> functions). The default value is <code>`Announce &quot;&gt;&gt; &quot;</code>.</li><li><code>`Output_all</code> lets all the output of the commands go through.</li><li><code>`Silent</code> is like <code>`Announce _</code> but without even the “prompt” command annoucement.</li></ul></li><li><code>?on_failure</code> configures what to do when encountering the first failure, the default is to display on stdout the name-tag of the failing command and outputting the contents of its <code>stdout</code> and <code>stderr</code> log-files (if any) <b>and then</b> call <code>exec [&quot;false&quot;]</code>.</li><li><code>?on_success</code> is a similar function as <code>?on_failure</code>, called before starting the next command, the default is to do nothing.</li><li><code>?tmpdir</code> configures where to create the logging files.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-on_stdin_lines" class="anchored"><a href="#val-on_stdin_lines" class="anchor"></a><code><span><span class="keyword">val</span> on_stdin_lines : <span><span>(<span><span><a href="#type-c_string">c_string</a> <a href="#type-t">t</a></span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span>&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>on_stdin_lines body</code> builds a loop that iterates over the lines of the <code>stdin</code> file descriptor. The argument of `body` is the current line. Note that this is for text-like input, <code>'\000'</code> characters in the input lead to undefined behavior.</p></div></div><h4 id="very-unsafe-operations"><a href="#very-unsafe-operations" class="anchor"></a>Very Unsafe Operations</h4><div class="odoc-spec"><div class="spec module" id="module-Magic" class="anchored"><a href="#module-Magic" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Magic/index.html">Magic</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <a href="Magic/index.html"><code>Magic</code></a> module is like OCaml's <code>Obj</code>.magic function for the EDSL; it allows one to bypass typing.</p></div></div></div></body></html>